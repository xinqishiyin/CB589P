C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE LCD
OBJECT MODULE PLACED IN lcd.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE lcd.c LARGE OPTIMIZE(6,SPEED) BROWSE INCDIR(G:\CB589P) DEBUG OBJECTEXTEND T
                    -ABS(2)

line level    source

   1          #include "system.h"
   2          #include "TM1722.h"
   3          #include "lcd.h"
   4          
   5          #include "memory.h"
   6          #include "Menu.h"
   7          #include "handler.h"
   8          #include "uart.h"
   9          
  10          extern tCbParam   mCbParam;
  11          extern tSqParam   mSqParam;
  12          extern tHmSetting   mHmSetting;
  13          extern tSysParam      mSysParam;
  14          extern tFlag        mFlag;
  15          extern xdata u8 StopSpk;
  16          extern u8 isButtonTone;
  17          extern u8 ButtonToneTime;
  18          extern tMenu mMenu;
  19          extern u8 key_SQSetIndex;
  20          u8 LCD_twinkle_Show=0;
  21          u8 LCD_Twinkle_tag=0;
  22          u8 ButtonLED=BUTTON_LED_TIME;
  23          
  24          void LoadLCDBeep()
  25          {
  26   1        switch(mHmSetting.LcdColor)                        //背景颜色            
  27   1        {
  28   2          case 0:
  29   2            LIGHT_B=0;
  30   2            LIGHT_G=0;
  31   2            LIGHT_R=0;
  32   2            break;
  33   2          case 1:
  34   2            LIGHT_B=0;
  35   2            LIGHT_G=0;
  36   2            LIGHT_R=1;
  37   2            break;
  38   2          case 2:
  39   2            LIGHT_B=0;
  40   2            LIGHT_G=1;
  41   2            LIGHT_R=0;
  42   2            break;
  43   2          case 3:
  44   2            LIGHT_B=0;
  45   2            LIGHT_G=1;
  46   2            LIGHT_R=1;
  47   2            break;
  48   2          case 4:
  49   2            LIGHT_B=1;
  50   2            LIGHT_G=0;
  51   2            LIGHT_R=0;
  52   2            break;
  53   2          case 5:
  54   2            LIGHT_B=1;
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 2   

  55   2            LIGHT_G=0;
  56   2            LIGHT_R=1;
  57   2            break;
  58   2          case 6:
  59   2            LIGHT_B=1;
  60   2            LIGHT_G=1;
  61   2            LIGHT_R=0;
  62   2            break;
  63   2          case 7:
  64   2            LIGHT_B=1;
  65   2            LIGHT_G=1;
  66   2            LIGHT_R=1;
  67   2            break;
  68   2          default:
  69   2            break;
  70   2        }
  71   1      
  72   1      }
  73          void RX_STRENGTH_SHOW()
  74          {
  75   1        if((mMenu.MenuIndex!=CHANNEL_VOL&&(mMenu.MenuIndex!=CHANNEL_SQ))||((mMenu.MenuIndex==CHANNEL_SQ)&&(mCbPar
             -am.Sq==0x00||mCbParam.Sq==0x20)))
  76   1        {
  77   2          
  78   2            if((mSysParam.Rssi&0x3f)>=25)     
  79   2                    LCD_STRENGTH(5);
  80   2            else if((mSysParam.Rssi&0x3f)>=22) LCD_STRENGTH(4);
  81   2            else if((mSysParam.Rssi&0x3f)>=14) LCD_STRENGTH(3);
  82   2            else if((mSysParam.Rssi&0x3f)>=7) LCD_STRENGTH(2);
  83   2            else if((mSysParam.Rssi&0x3f)>=2) LCD_STRENGTH(1);
  84   2            else LCD_STRENGTH(0);
  85   2          
  86   2      
  87   2        }
  88   1        
  89   1      }
  90          /*-------------------------------------------------------------------------
  91          *函数：ShowChannel  通道界面
  92          *参数：无  
  93          *返回值：无
  94          *-------------------------------------------------------------------------*/
  95          void ShowChannel()       //通道界面
  96          {
  97   1        LCD_CLEAR();
  98   1        CheckTxPower();
  99   1        if( mCbParam.Modu==FM)
 100   1        {
 101   2          LCD_FM(1);
 102   2          LCD_AM(0);
 103   2        }
 104   1        else
 105   1        {
 106   2          LCD_AM(1);
 107   2          LCD_FM(0);
 108   2        }
 109   1        if(mCbParam.Country==COUNTRY_RU||mCbParam.Country==COUNTRY_PX)
 110   1        {
 111   2          LCD_NUM1(mCbParam.Channel/10);
 112   2          LCD_NUM2(mCbParam.Channel%10);
 113   2          LCD_NUM3(mCbParam.Band+10);
 114   2        } 
 115   1        else if(mCbParam.Country==COUNTRY_AM)                             //AM国家时   1：68 72 82 86 88 90 91 94
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 3   

             - 96 98
 116   1        {
 117   2          switch(mCbParam.Channel)
 118   2          {
 119   3            case 1: LCD_NUM1(6);  LCD_NUM2(8);  break;
 120   3            case 2: LCD_NUM1(7);  LCD_NUM2(2);  break;
 121   3            case 3: LCD_NUM1(8);  LCD_NUM2(2);  break;
 122   3            case 4: LCD_NUM1(8);  LCD_NUM2(6);  break;
 123   3            case 5: LCD_NUM1(8);  LCD_NUM2(8);  break;
 124   3            case 6: LCD_NUM1(9);  LCD_NUM2(0);  break;
 125   3            case 7: LCD_NUM1(9);  LCD_NUM2(1);  break;
 126   3            case 8: LCD_NUM1(9);  LCD_NUM2(4);  break;
 127   3            case 9: LCD_NUM1(9);  LCD_NUM2(6);  break;
 128   3            case 10:  LCD_NUM1(9);  LCD_NUM2(8);  break;
 129   3          }
 130   2        }
 131   1        else 
 132   1        {
 133   2          LCD_NUM1(mCbParam.Channel/10);
 134   2          LCD_NUM2(mCbParam.Channel%10);
 135   2        }
 136   1        if(mCbParam.RfgLevel!=0)LCD_NUM5(NUM5_R);
 137   1      
 138   1        if(mCbParam.TxPower == POWER_1W)LCD_LOW(1);
 139   1        if(mSqParam.IsAsq)LCD_ASQ(1); 
 140   1        
 141   1        if(mSysParam.isMute==0)   LCD_NUM4(NUM4_OFF);
 142   1        else LCD_NUM4(NUM4_M);
 143   1        if(mMenu.emgIndex==0) LCD_EMG(0);
 144   1        else LCD_EMG(1);
 145   1        if(mSqParam.Scan==2)LCD_SCAN(1);
 146   1        else LCD_SCAN(0);
 147   1        if(mSqParam.DWSet!=0)LCD_DW(1);
 148   1        else LCD_DW(0);
 149   1        switch(mHmSetting.LcdColor)                        //背景颜色            
 150   1        {
 151   2          case 0:
 152   2            LIGHT_B=0;
 153   2            LIGHT_G=0;
 154   2            LIGHT_R=0;
 155   2            break;
 156   2          case 1:
 157   2            LIGHT_B=0;
 158   2            LIGHT_G=0;
 159   2            LIGHT_R=1;
 160   2            break;
 161   2          case 2:
 162   2            LIGHT_B=0;
 163   2            LIGHT_G=1;
 164   2            LIGHT_R=0;
 165   2            break;
 166   2          case 3:
 167   2            LIGHT_B=0;
 168   2            LIGHT_G=1;
 169   2            LIGHT_R=1;
 170   2            break;
 171   2          case 4:
 172   2            LIGHT_B=1;
 173   2            LIGHT_G=0;
 174   2            LIGHT_R=0;
 175   2            break;
 176   2          case 5:
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 4   

 177   2            LIGHT_B=1;
 178   2            LIGHT_G=0;
 179   2            LIGHT_R=1;
 180   2            break;
 181   2          case 6:
 182   2            LIGHT_B=1;
 183   2            LIGHT_G=1;
 184   2            LIGHT_R=0;
 185   2            break;
 186   2          case 7:
 187   2            LIGHT_B=1;
 188   2            LIGHT_G=1;
 189   2            LIGHT_R=1;
 190   2            break;
 191   2          default:
 192   2            break;
 193   2        }
 194   1        RX_STRENGTH_SHOW();
 195   1        TM1722_SHOW();
 196   1      }
 197          /*-------------------------------------------------------------------------
 198          *函数：ShowFreCalSet  频偏调节显示
 199          *参数：无  
 200          *返回值：无
 201          *-------------------------------------------------------------------------*/
 202          void ShowFreCalSet()
 203          {
 204   1        LCD_NUM1(NUM1_F);
 205   1        LCD_NUM2(NUM2_C);
 206   1        if(mCbParam.FreqCal<110)
 207   1        {
 208   2          LCD_NUM3(NUM3_SIGN);
 209   2          LCD_NUM4((110-mCbParam.FreqCal)/10);
 210   2          LCD_NUM5((110-mCbParam.FreqCal)%10);
 211   2        }
 212   1        else
 213   1        {
 214   2          LCD_NUM3(NUM3_OFF);
 215   2          LCD_NUM4((mCbParam.FreqCal-100)/10);
 216   2          LCD_NUM5((mCbParam.FreqCal-100)/10);
 217   2        }
 218   1          
 219   1      }
 220          
 221          /*-------------------------------------------------------------------------
 222          *函数：ShowSQReSet  SQ调节显示
 223          *参数：无  
 224          *返回值：无
 225          *-------------------------------------------------------------------------*/
 226          void ShowSQReSet()
 227          {
 228   1        LCD_CLEAR();
 229   1        if(mSqParam.OpenOrClose==0)
 230   1        {
 231   2          if(mSqParam.OpenSet>=0)
 232   2          {
 233   3            LCD_NUM4(mSqParam.OpenSet/10);
 234   3            LCD_NUM5(mSqParam.OpenSet%10);
 235   3          }
 236   2          else
 237   2          {
 238   3            LCD_NUM4((-mSqParam.OpenSet)/10);
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 5   

 239   3            LCD_NUM5((-mSqParam.OpenSet)%10);
 240   3          }
 241   2          if(mSqParam.OpenSet>=0)
 242   2          {
 243   3            LCD_NUM3(NUM3_UP_P);
 244   3          }
 245   2          else
 246   2          {
 247   3            LCD_NUM3(NUM3_UP_D);
 248   3          }
 249   2        }
 250   1        else
 251   1        {
 252   2          if(mSqParam.CloseSet>=0)
 253   2          {
 254   3            LCD_NUM4(mSqParam.CloseSet/10);
 255   3            LCD_NUM5(mSqParam.CloseSet%10);
 256   3          }
 257   2          else
 258   2          {
 259   3            LCD_NUM4((-mSqParam.CloseSet)/10);
 260   3            LCD_NUM5((-mSqParam.CloseSet)%10);
 261   3          }
 262   2            if(mSqParam.CloseSet>=0)
 263   2          {
 264   3            LCD_NUM3(NUM3_DN_P);
 265   3          }
 266   2          else
 267   2          {
 268   3            LCD_NUM3(NUM3_DN_D);
 269   3          }
 270   2        
 271   2        }
 272   1      
 273   1        if(mSqParam.IsAsq==0)
 274   1        {
 275   2          LCD_NUM1(mSqParam.SqLevel/10);
 276   2          LCD_NUM2(mSqParam.SqLevel%10);  
 277   2        }
 278   1        else
 279   1        {
 280   2          LCD_NUM1(mSqParam.AsqLevel/10);
 281   2          LCD_NUM2(mSqParam.AsqLevel%10);
 282   2          LCD_ASQ(1);
 283   2        
 284   2        
 285   2        }
 286   1        
 287   1        TM1722_SHOW();
 288   1      }
 289          /*-------------------------------------------------------------------------
 290          *函数：Twinkle_Control  闪烁控制
 291          *参数：无  
 292          *返回值：无
 293          *-------------------------------------------------------------------------*/
 294          void Twinkle_Control(void)
 295          { 
 296   1        if(mHmSetting.ButtonLedSwitch!=0)         //按键背景灯
 297   1        {
 298   2          if(ButtonLED>0)
 299   2          {
 300   3            LCD_LED=1;
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 6   

 301   3            ButtonLED--;
 302   3          }
 303   2          if(ButtonLED==0)
 304   2          {
 305   3            LCD_LED=0;
 306   3          }   
 307   2        }
 308   1        else LCD_LED=0;
 309   1        switch(mMenu.MenuIndex)
 310   1        {
 311   2          case CHANNEL:
 312   2            if(mMenu.emgIndex!=0)      //EMG开启 闪烁                               
 313   2            {   
 314   3              if(LCD_twinkle_Show>0)LCD_twinkle_Show--;     
 315   3              else
 316   3              {
 317   4                if(LCD_Twinkle_tag==0)
 318   4                {
 319   5                  LCD_EMG(1);
 320   5                  LCD_Twinkle_tag=1;
 321   5                }
 322   4                else 
 323   4                {
 324   5                  LCD_EMG(0);
 325   5                  LCD_Twinkle_tag=0;
 326   5                }
 327   4                LCD_twinkle_Show=SHOW_TWINKLE_TIME;
 328   4              }   
 329   3            }
 330   2            RX_STRENGTH_SHOW();
 331   2            break;
 332   2          case CHANNEL_RFG:                               //RFG开启 闪烁             
 333   2            if(LCD_twinkle_Show>0)  LCD_twinkle_Show--;   
 334   2            else
 335   2            {
 336   3              if(LCD_Twinkle_tag==0)
 337   3              {
 338   4                LCD_NUM1(NUM1_OFF);
 339   4                LCD_NUM2(NUM2_OFF); 
 340   4                LCD_Twinkle_tag=1;
 341   4              }
 342   3              else 
 343   3              {
 344   4                LCD_NUM1((mCbParam.RfgLevel*6)/10);
 345   4                LCD_NUM2((mCbParam.RfgLevel*6)%10); 
 346   4                LCD_Twinkle_tag=0;
 347   4              }
 348   3              LCD_twinkle_Show=SHOW_TWINKLE_TIME;
 349   3            }   
 350   2            RX_STRENGTH_SHOW();
 351   2            break;
 352   2          case CHANNEL_SQ:                              //SQ/ASQ开启 闪烁   
 353   2      
 354   2            if(mSqParam.IsAsq==0)
 355   2            {
 356   3              if(LCD_twinkle_Show>0)  LCD_twinkle_Show--;   
 357   3              else
 358   3              {
 359   4                if(LCD_Twinkle_tag==0)
 360   4                {
 361   5                  LCD_NUM1(NUM1_OFF);
 362   5                  LCD_NUM2(NUM2_OFF); 
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 7   

 363   5                  LCD_Twinkle_tag=1;
 364   5                }
 365   4                else 
 366   4                {
 367   5                  LCD_NUM1(mSqParam.SqLevel/10);
 368   5                  LCD_NUM2(mSqParam.SqLevel%10);  
 369   5                  LCD_Twinkle_tag=0;
 370   5                }
 371   4                LCD_twinkle_Show=SHOW_TWINKLE_TIME;
 372   4              } 
 373   3            }
 374   2            else 
 375   2            {
 376   3              if(LCD_twinkle_Show>0)  LCD_twinkle_Show--;   
 377   3              else
 378   3              {
 379   4                if(LCD_Twinkle_tag==0)
 380   4                {
 381   5                  LCD_NUM1(NUM1_OFF);
 382   5                  LCD_NUM2(NUM2_OFF); 
 383   5                  LCD_Twinkle_tag=1;
 384   5                }
 385   4                else 
 386   4                {
 387   5                  LCD_NUM1(mSqParam.AsqLevel/10);
 388   5                  LCD_NUM2(mSqParam.AsqLevel%10); 
 389   5                  LCD_Twinkle_tag=0;
 390   5                }
 391   4                LCD_twinkle_Show=SHOW_TWINKLE_TIME;
 392   4              } 
 393   3            }     
 394   2            RX_STRENGTH_SHOW();
 395   2            break;
 396   2          case CHANNEL_SCAN:
 397   2            LCD_SCAN(1);
 398   2            RX_STRENGTH_SHOW();
 399   2            break;
 400   2          case CHANNEL_DW:
 401   2            if(mSqParam.DWSet==1)
 402   2            {
 403   3              if(LCD_twinkle_Show>0)  LCD_twinkle_Show--;   
 404   3              else
 405   3              {
 406   4                if(LCD_Twinkle_tag==0)
 407   4                {
 408   5                  LCD_NUM1(NUM1_OFF);
 409   5                  LCD_NUM2(NUM2_OFF); 
 410   5                  LCD_Twinkle_tag=1;
 411   5                }
 412   4                else 
 413   4                {
 414   5                  if(mCbParam.Country==COUNTRY_AM)                             //AM国家时   1：68 72 82 86 88 90 91 94
             - 96 98
 415   5                  {
 416   6                    switch(mCbParam.Channel)
 417   6                    {
 418   7                      case 1: LCD_NUM1(6);  LCD_NUM2(8);  break;
 419   7                      case 2: LCD_NUM1(7);  LCD_NUM2(2);  break;
 420   7                      case 3: LCD_NUM1(8);  LCD_NUM2(2);  break;
 421   7                      case 4: LCD_NUM1(8);  LCD_NUM2(6);  break;
 422   7                      case 5: LCD_NUM1(8);  LCD_NUM2(8);  break;
 423   7                      case 6: LCD_NUM1(9);  LCD_NUM2(0);  break;
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 8   

 424   7                      case 7: LCD_NUM1(9);  LCD_NUM2(1);  break;
 425   7                      case 8: LCD_NUM1(9);  LCD_NUM2(4);  break;
 426   7                      case 9: LCD_NUM1(9);  LCD_NUM2(6);  break;
 427   7                      case 10:  LCD_NUM1(9);  LCD_NUM2(8);  break;
 428   7                    }
 429   6                  }
 430   5                  else 
 431   5                  {
 432   6                    LCD_NUM1(mCbParam.Channel/10);
 433   6                    LCD_NUM2(mCbParam.Channel%10);
 434   6                  }
 435   5                  LCD_Twinkle_tag=0;
 436   5                }
 437   4                LCD_twinkle_Show=SHOW_TWINKLE_TIME;
 438   4              }   
 439   3           }
 440   2            LCD_DW(1);
 441   2            RX_STRENGTH_SHOW();
 442   2            break;
 443   2         case CHANNEL_VOL:
 444   2           
 445   2            if(LCD_twinkle_Show>0)  LCD_twinkle_Show--;   
 446   2            else
 447   2            {
 448   3              if(LCD_Twinkle_tag==0)
 449   3              {
 450   4                LCD_NUM1(NUM1_OFF);
 451   4                LCD_NUM2(NUM2_OFF); 
 452   4                LCD_Twinkle_tag=1;
 453   4              }
 454   3              else 
 455   3              {
 456   4                LCD_NUM1(mCbParam.VolLevel/10);
 457   4                LCD_NUM2(mCbParam.VolLevel%10);         
 458   4                LCD_Twinkle_tag=0;
 459   4              }
 460   3              LCD_twinkle_Show=SHOW_TWINKLE_TIME;
 461   3            }   
 462   2              
 463   2           break;
 464   2         case CHANNEL_SQ_SET:
 465   2           
 466   2           switch(key_SQSetIndex)
 467   2           {
 468   3             case 0:
 469   3                if(LCD_twinkle_Show>0)  LCD_twinkle_Show--;   
 470   3                else
 471   3                {
 472   4                  if(LCD_Twinkle_tag==0)
 473   4                  {
 474   5                    LCD_NUM1(NUM1_OFF);
 475   5                    LCD_NUM2(NUM2_OFF); 
 476   5                    LCD_Twinkle_tag=1;
 477   5                  }
 478   4                  else 
 479   4                  {
 480   5                    if(mSqParam.IsAsq==0)
 481   5                    {
 482   6                      LCD_NUM1(mSqParam.SqLevel/10);
 483   6                      LCD_NUM2(mSqParam.SqLevel%10);  
 484   6                  
 485   6                    }
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 9   

 486   5                    else
 487   5                    {
 488   6                      LCD_NUM1(mSqParam.AsqLevel/10);
 489   6                      LCD_NUM2(mSqParam.AsqLevel%10);
 490   6                    }
 491   5                    LCD_Twinkle_tag=0;
 492   5                  }
 493   4                  LCD_twinkle_Show=SHOW_TWINKLE_TIME;
 494   4                } 
 495   3                if(mSqParam.OpenOrClose==0)
 496   3                {
 497   4                  if(mSqParam.OpenSet>=0)
 498   4                  {
 499   5                    LCD_NUM4(mSqParam.OpenSet/10);
 500   5                    LCD_NUM5(mSqParam.OpenSet%10);
 501   5                  }
 502   4                  else
 503   4                  {
 504   5                    LCD_NUM4((-mSqParam.OpenSet)/10);
 505   5                    LCD_NUM5((-mSqParam.OpenSet)%10);
 506   5                  }
 507   4                  if(mSqParam.OpenSet>=0)
 508   4                  {
 509   5                    LCD_NUM3(NUM3_UP_P);
 510   5                  }
 511   4                  else
 512   4                  {
 513   5                    LCD_NUM3(NUM3_UP_D);
 514   5                  }
 515   4                }
 516   3                else
 517   3                {
 518   4                  if(mSqParam.CloseSet>=0)
 519   4                  {
 520   5                    LCD_NUM4(mSqParam.CloseSet/10);
 521   5                    LCD_NUM5(mSqParam.CloseSet%10);
 522   5                  }
 523   4                  else
 524   4                  {
 525   5                    LCD_NUM4((-mSqParam.CloseSet)/10);
 526   5                    LCD_NUM5((-mSqParam.CloseSet)%10);
 527   5                  }
 528   4                  
 529   4                  if((mSqParam.OpenSet>=0&&mSqParam.OpenOrClose==0)||(mSqParam.CloseSet>=0&&mSqParam.OpenOrClose==1))
 530   4                  {
 531   5                    LCD_NUM3(NUM3_DN_P);
 532   5                  }
 533   4                  else
 534   4                  {
 535   5                    LCD_NUM3(NUM3_DN_D);
 536   5                  }
 537   4                }
 538   3                if(mSqParam.IsAsq==0)
 539   3                {
 540   4                }
 541   3                else
 542   3                {           
 543   4                  LCD_ASQ(1);
 544   4                  
 545   4                
 546   4                }         
 547   3               break;
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 10  

 548   3             case 1:
 549   3               if(LCD_twinkle_Show>0) LCD_twinkle_Show--;   
 550   3                else
 551   3                {
 552   4                  if(LCD_Twinkle_tag==0)
 553   4                  {
 554   5                    if((mSqParam.OpenSet<0&&mSqParam.OpenOrClose==0)||(mSqParam.CloseSet<0&&mSqParam.OpenOrClose==1))
 555   5                    {
 556   6                      LCD_NUM3(NUM3_SIGN);
 557   6                    }         
 558   5                    else
 559   5                    {
 560   6                      LCD_NUM3(NUM3_OFF); 
 561   6                    }
 562   5                    LCD_Twinkle_tag=1;
 563   5                  }
 564   4                  else 
 565   4                  {
 566   5                    if(mSqParam.OpenOrClose==0)
 567   5                    {
 568   6                          
 569   6                      if(mSqParam.OpenSet>=0)
 570   6                      {
 571   7                        LCD_NUM4(mSqParam.OpenSet/10);
 572   7                        LCD_NUM5(mSqParam.OpenSet%10);
 573   7                      }
 574   6                      else
 575   6                      {
 576   7                        LCD_NUM4((-mSqParam.OpenSet)/10);
 577   7                        LCD_NUM5((-mSqParam.OpenSet)%10);
 578   7                      }
 579   6                      if(mSqParam.OpenSet>=0)
 580   6                      {
 581   7                        LCD_NUM3(NUM3_UP_P);
 582   7                      }
 583   6                      else
 584   6                      {
 585   7                        LCD_NUM3(NUM3_UP_D);
 586   7                      }
 587   6                    }
 588   5                    else
 589   5                    {
 590   6                      if(mSqParam.CloseSet>=0)
 591   6                      {
 592   7                        LCD_NUM4(mSqParam.CloseSet/10);
 593   7                        LCD_NUM5(mSqParam.CloseSet%10);
 594   7                      }
 595   6                      else
 596   6                      {
 597   7                        LCD_NUM4((-mSqParam.CloseSet)/10);
 598   7                        LCD_NUM5((-mSqParam.CloseSet)%10);
 599   7                      }
 600   6                      if(mSqParam.CloseSet>=0)
 601   6                      {
 602   7                        LCD_NUM3(NUM3_DN_P);
 603   7                      }
 604   6                      else
 605   6                      {
 606   7                        LCD_NUM3(NUM3_DN_D);
 607   7                      }
 608   6                    }
 609   5                    LCD_Twinkle_tag=0;
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 11  

 610   5                  }
 611   4                  LCD_twinkle_Show=SHOW_TWINKLE_TIME;
 612   4                } 
 613   3             
 614   3              if(mSqParam.IsAsq==0)
 615   3              {
 616   4                LCD_NUM1(mSqParam.SqLevel/10);
 617   4                LCD_NUM2(mSqParam.SqLevel%10);
 618   4            
 619   4              }
 620   3              else
 621   3              {
 622   4                LCD_NUM1(mSqParam.AsqLevel/10);
 623   4                LCD_NUM2(mSqParam.AsqLevel%10);
 624   4                LCD_ASQ(1);
 625   4              }        
 626   3             
 627   3               break;
 628   3             case 2:
 629   3               if(LCD_twinkle_Show>0) LCD_twinkle_Show--;   
 630   3                else
 631   3                {
 632   4                  if(LCD_Twinkle_tag==0)
 633   4                  {
 634   5                    if(mSqParam.OpenOrClose==0)
 635   5                    {             
 636   6                        LCD_NUM3(NUM3_UP_P);
 637   6                    }
 638   5                    else
 639   5                    {               
 640   6                        LCD_NUM3(NUM3_DN_P);                
 641   6                    }
 642   5                    LCD_NUM4(NUM4_OFF);
 643   5                    LCD_NUM5(NUM5_OFF); 
 644   5                    LCD_Twinkle_tag=1;
 645   5                  }
 646   4                  else 
 647   4                  {
 648   5                    if(mSqParam.OpenOrClose==0)
 649   5                    {
 650   6                      if(mSqParam.OpenSet>=0)
 651   6                      {
 652   7                        LCD_NUM4(mSqParam.OpenSet/10);
 653   7                        LCD_NUM5(mSqParam.OpenSet%10);
 654   7                      }
 655   6                      else
 656   6                      {
 657   7                        LCD_NUM4((-mSqParam.OpenSet)/10);
 658   7                        LCD_NUM5((-mSqParam.OpenSet)%10);
 659   7                      }
 660   6                      if(mSqParam.OpenSet>=0)
 661   6                      {
 662   7                        LCD_NUM3(NUM3_UP_P);
 663   7                      }
 664   6                      else
 665   6                      {
 666   7                        LCD_NUM3(NUM3_UP_D);
 667   7                      }
 668   6                    }
 669   5                    else
 670   5                    {
 671   6                      if(mSqParam.CloseSet>=0)
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 12  

 672   6                      {
 673   7                        LCD_NUM4(mSqParam.CloseSet/10);
 674   7                        LCD_NUM5(mSqParam.CloseSet%10);
 675   7                      }
 676   6                      else
 677   6                      {
 678   7                        LCD_NUM4((-mSqParam.CloseSet)/10);
 679   7                        LCD_NUM5((-mSqParam.CloseSet)%10);
 680   7                      }   
 681   6                      if(mSqParam.CloseSet>=0)
 682   6                      {
 683   7                        LCD_NUM3(NUM3_DN_P);
 684   7                      }
 685   6                      else
 686   6                      {
 687   7                        LCD_NUM3(NUM3_DN_D);
 688   7                      }
 689   6                    }
 690   5                    if(mSqParam.IsAsq==0)
 691   5                    {
 692   6                      
 693   6                     }
 694   5                    else
 695   5                    {           
 696   6                            
 697   6                    }
 698   5                    LCD_Twinkle_tag=0;
 699   5                  }
 700   4                  LCD_twinkle_Show=SHOW_TWINKLE_TIME;
 701   4                }   
 702   3                  
 703   3               break;
 704   3           }
 705   2           break;
 706   2          default:
 707   2            break;
 708   2        }
 709   1        
 710   1      }
 711          
 712          void wriless_button()
 713          {
 714   1        if(mHmSetting.ButtonLedSwitch!=0)         //按键背景灯
 715   1        {
 716   2          if(ButtonLED>0)
 717   2          {
 718   3            LCD_LED=1;
 719   3            ButtonLED--;
 720   3          }
 721   2          if(ButtonLED==0)
 722   2          {
 723   3            LCD_LED=0;
 724   3          }   
 725   2        }
 726   1        else LCD_LED=0;
 727   1      }
 728          
 729          /*-------------------------------------------------------------------------
 730          *函数：ShowVol  音量设置界面
 731          *参数：无  
 732          *返回值：无
 733          *-------------------------------------------------------------------------*/
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 13  

 734          void ShowVol()          //音量设置界面
 735          {
 736   1        LCD_CLEAR();
 737   1        LCD_NUM1(mCbParam.VolLevel/10);
 738   1        LCD_NUM2(mCbParam.VolLevel%10); 
 739   1        TM1722_SHOW();
 740   1      }
 741          /*-------------------------------------------------------------------------
 742          *函数：ShowRfg  RFGAIN等级设置界面
 743          *参数：无  
 744          *返回值：无
 745          *-------------------------------------------------------------------------*/
 746          void ShowRfg()
 747          {
 748   1        LCD_CLEAR();
 749   1        LCD_NUM1((mCbParam.RfgLevel*6)/10);
 750   1        LCD_NUM2((mCbParam.RfgLevel*6)%10); 
 751   1        LCD_NUM5(NUM5_R);
 752   1        TM1722_SHOW();
 753   1      }
 754          /*-------------------------------------------------------------------------
 755          *函数：ShowSpeakSwitch  声音选择切换
 756          *参数：无  
 757          *返回值：无
 758          *-------------------------------------------------------------------------*/
 759          void ShowSpeakSwitch()
 760          {
 761   1        LCD_CLEAR();
 762   1        LCD_NUM1(NUM1_S);
 763   1        LCD_NUM2(NUM2_P);
 764   1        if(mHmSetting.SpkerSwitch==1)
 765   1        {
 766   2          LCD_NUM4(NUM4_O);
 767   2          LCD_NUM5(NUM5_N);
 768   2        }
 769   1        else
 770   1        {
 771   2          LCD_NUM3(NUM3_O);
 772   2          LCD_NUM4(NUM4_F);
 773   2          LCD_NUM5(NUM5_F);
 774   2        }
 775   1        TM1722_SHOW();
 776   1      }
 777          
 778          /*-------------------------------------------------------------------------
 779          *函数：ShowSq  SQ等级设置界面
 780          *参数：无  
 781          *返回值：无
 782          *-------------------------------------------------------------------------*/
 783          void ShowSq()                //SQ设置界面
 784          {
 785   1        LCD_CLEAR();
 786   1        LCD_NUM1(mSqParam.SqLevel/10);
 787   1        LCD_NUM2(mSqParam.SqLevel%10);
 788   1        LCD_NUM4(NUM4_S);
 789   1        LCD_NUM5(NUM5_Q);
 790   1        TM1722_SHOW();
 791   1      }
 792          /*-------------------------------------------------------------------------
 793          *函数：ShowAsq  ASQ等级设置界面
 794          *参数：无  
 795          *返回值：无
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 14  

 796          *-------------------------------------------------------------------------*/
 797          void ShowAsq()              //ASQ设置界面
 798          {
 799   1        LCD_CLEAR();
 800   1        LCD_NUM1(mSqParam.AsqLevel/10);
 801   1        LCD_NUM2(mSqParam.AsqLevel%10);
 802   1        LCD_NUM4(NUM4_A);
 803   1        LCD_NUM5(NUM5_Q);
 804   1        TM1722_SHOW();
 805   1      }
 806          /*-------------------------------------------------------------------------
 807          *函数：ShowBP 按键灯
 808          *参数：无  
 809          *返回值：无
 810          *-------------------------------------------------------------------------*/
 811          void ShowBP()
 812          {
 813   1        LCD_CLEAR();
 814   1        LCD_NUM1(NUM1_F);
 815   1        LCD_NUM2(NUM2_L);
 816   1        if(mHmSetting.ButtonLedSwitch)
 817   1        {
 818   2          LCD_NUM3(NUM3_OFF);
 819   2          LCD_NUM4(NUM4_O);
 820   2          LCD_NUM5(NUM5_N);
 821   2        }
 822   1        else
 823   1        {
 824   2          LCD_NUM3(NUM3_O);
 825   2          LCD_NUM4(NUM4_F);
 826   2          LCD_NUM5(NUM5_F);
 827   2        }
 828   1        TM1722_SHOW();
 829   1      }
 830          /*-------------------------------------------------------------------------
 831          *函数：ShowFB  按键音切换
 832          *参数：无  
 833          *返回值：无
 834          *-------------------------------------------------------------------------*/
 835          void ShowFB()
 836          {
 837   1        LCD_CLEAR();
 838   1        LCD_NUM1(NUM1_F);
 839   1        LCD_NUM2(NUM2_B);
 840   1        if(mHmSetting.ButtonToneSwitch)
 841   1        {
 842   2          LCD_NUM3(NUM3_OFF);
 843   2          LCD_NUM4(NUM4_O);
 844   2          LCD_NUM5(NUM5_N);
 845   2        }
 846   1        else
 847   1        {
 848   2          LCD_NUM3(NUM3_O);
 849   2          LCD_NUM4(NUM4_F);
 850   2          LCD_NUM5(NUM5_F);
 851   2        }
 852   1        TM1722_SHOW();
 853   1      }
 854          /*-------------------------------------------------------------------------
 855          *函数：ShowFB  按键音切换
 856          *参数：无  
 857          *返回值：无
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 15  

 858          *-------------------------------------------------------------------------*/
 859          void ShowFC()
 860          {
 861   1        LCD_CLEAR();
 862   1        LCD_NUM1(NUM1_F);
 863   1        LCD_NUM2(NUM2_C);
 864   1        switch(mHmSetting.LcdColor)
 865   1        {
 866   2          case 0:LCD_NUM3(0);
 867   2            break;
 868   2          case 1:LCD_NUM3(1);
 869   2            break;
 870   2          case 2:LCD_NUM3(2);
 871   2            break;
 872   2          case 3:LCD_NUM3(3);
 873   2            break;
 874   2          case 4:LCD_NUM3(4);
 875   2            break;
 876   2          case 5:LCD_NUM3(5);
 877   2            break;
 878   2          case 6:LCD_NUM3(6);
 879   2            break;
 880   2          case 7:LCD_NUM3(7);
 881   2            break;
 882   2        }   
 883   1      
 884   1        switch(mHmSetting.LcdColor)                        //背景颜色            
 885   1        {
 886   2          case 0:
 887   2            LIGHT_B=0;
 888   2            LIGHT_G=0;
 889   2            LIGHT_R=0;
 890   2            break;
 891   2          case 1:
 892   2            LIGHT_B=0;
 893   2            LIGHT_G=0;
 894   2            LIGHT_R=1;
 895   2            break;
 896   2          case 2:
 897   2            LIGHT_B=0;
 898   2            LIGHT_G=1;
 899   2            LIGHT_R=0;
 900   2            break;
 901   2          case 3:
 902   2            LIGHT_B=0;
 903   2            LIGHT_G=1;
 904   2            LIGHT_R=1;
 905   2            break;
 906   2          case 4:
 907   2            LIGHT_B=1;
 908   2            LIGHT_G=0;
 909   2            LIGHT_R=0;
 910   2            break;
 911   2          case 5:
 912   2            LIGHT_B=1;
 913   2            LIGHT_G=0;
 914   2            LIGHT_R=1;
 915   2            break;
 916   2          case 6:
 917   2            LIGHT_B=1;
 918   2            LIGHT_G=1;
 919   2            LIGHT_R=0;
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 16  

 920   2            break;
 921   2          case 7:
 922   2            LIGHT_B=1;
 923   2            LIGHT_G=1;
 924   2            LIGHT_R=1;
 925   2            break;
 926   2          default:
 927   2            break;
 928   2        }
 929   1        TM1722_SHOW();
 930   1      }
 931          /*-------------------------------------------------------------------------
 932          *函数：ShowTable  显示国家表
 933          *参数：无  
 934          *返回值：无
 935          *-------------------------------------------------------------------------*/
 936          void ShowTable()
 937          {
 938   1        LCD_CLEAR();
 939   1        LCD_NUM3(mCbParam.CountryTable);
 940   1        LCD_NUM4(NUM4_T);
 941   1        LCD_NUM5(NUM5_B);
 942   1        TM1722_SHOW();
 943   1      }
 944          /*-------------------------------------------------------------------------
 945          *函数：ShowTable  显示国家表
 946          *参数：无  
 947          *返回值：无
 948          *-------------------------------------------------------------------------*/
 949          void ShowSQSet()
 950          {
 951   1        LCD_CLEAR();
 952   1        if(mSqParam.IsAsq==0)
 953   1        {
 954   2          LCD_NUM1(mSqParam.SqLevel/10);
 955   2          LCD_NUM2(mSqParam.SqLevel%10);
 956   2        }
 957   1        else
 958   1        {
 959   2          LCD_NUM1(mSqParam.AsqLevel/10);
 960   2          LCD_NUM2(mSqParam.AsqLevel%10);
 961   2        }
 962   1        TM1722_SHOW();
 963   1      }
 964          
 965          /*-------------------------------------------------------------------------
 966          *函数：ShowFactorySeting  重启显示
 967          *参数：无  
 968          *返回值：无
 969          *-------------------------------------------------------------------------*/
 970          void ShowFactorySeting()
 971          {
 972   1        initLCD();
 973   1        
 974   1      }
 975          /*-------------------------------------------------------------------------
 976          *函数：playButtonTone  按键音
 977          *参数：无  
 978          *返回值：无
 979          *-------------------------------------------------------------------------*/
 980          void playButtonTone(void)
 981          {
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 17  

 982   1        //播放提示音
 983   1        //if(SPK_EN == 0) //没有接收到信号时播放
 984   1        //{
 985   1          if(mFlag.SpkOpen ==1||mSqParam.SqLevel==0)
 986   1          return;
 987   1          if((mHmSetting.ButtonToneSwitch==1)&&(mFlag.SpkOpen==0)) 
 988   1          {   
 989   2            //xPWMCN &= ~0x10;  
 990   2            //SPK_EN=0;
 991   2            xPWMCN |= 0x10;     
 992   2            SPK_EN=1;
 993   2            isButtonTone=1;
 994   2            ButtonToneTime=BUTTON_TIME;
 995   2          }
 996   1        //}
 997   1      }
 998          void ShowHitPower()
 999          {
1000   1        LCD_CLEAR();
1001   1        
1002   1      }
1003          
1004          /*-------------------------------------------------------------------------
1005          *函数：initLCD  LCD开机显示全屏和国家初使化
1006          *参数：无  
1007          *返回值：无
1008          *-------------------------------------------------------------------------*/
1009          void initLCD()             
1010          {
1011   1        if(mHmSetting.ButtonLedSwitch!=0)LCD_LED=1;        //按钮灯
1012   1        else LCD_LED=0;
1013   1        TM1722_Init();  
1014   1      
1015   1        delayms(POWER_ON_ALLLCD_TIME);
1016   1        setContry();
1017   1      }
1018          /*-------------------------------------------------------------------------
1019          *函数：setContry  设置国家
1020          *参数：无  
1021          *返回值：无
1022          *-------------------------------------------------------------------------*/
1023          void setContry()
1024          {
1025   1        LCD_CLEAR();
1026   1        //if(mCbParam.Country==COUNTRY_AM)LCD_AM(1);
1027   1        //else LCD_FM(1);
1028   1        ShowContry(mCbParam.Country);
1029   1        delayms(POWER_ON_SHOW_CONTRY);
1030   1        LCD_CLEAR();  
1031   1        CheckHitPower();
1032   1        TM1722_SHOW();
1033   1      }
1034          
1035          
1036          void lcdShowError(void)
1037          {
1038   1        LCD_NUM1(NUM1_E);
1039   1        LCD_NUM2(1);
1040   1        TM1722_SHOW();
1041   1      }
1042          
1043          
C51 COMPILER V9.52.0.0   LCD                                                               06/02/2018 10:26:55 PAGE 18  

1044          void CheckHitPower()
1045          {
1046   1        if(mHmSetting.isCheckHitPower!=0)
1047   1        {
1048   2                  LCD_CLEAR();
1049   2          if(mSysParam.HitPower==0)
1050   2          {
1051   3            mSysParam.HitPower=1;
1052   3            LCD_NUM1(NUM1_H);
1053   3          }
1054   2          else 
1055   2          {
1056   3            mSysParam.HitPower=0;
1057   3            LCD_NUM1(NUM1_L);
1058   3          }
1059   2          LCD_NUM2(NUM2_Y);
1060   2          LCD_NUM3(NUM3_P);
1061   2          TM1722_SHOW();
1062   2          delayms(700);
1063   2          saveData(EEP_HIT_POWER,mSysParam.HitPower);
1064   2         
1065   2        } 
1066   1        //ShowChannel();
1067   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3755    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      3    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

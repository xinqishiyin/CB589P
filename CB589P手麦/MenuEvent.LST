C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MENUEVENT
OBJECT MODULE PLACED IN MenuEvent.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE MenuEvent.c LARGE OPTIMIZE(6,SPEED) BROWSE INCDIR(G:\CB589P) DEBUG OBJECTEX
                    -TEND TABS(2)

line level    source

   1          //EMG
   2          #include "MenuEvent.h"
   3          #include "system.h"
   4          #include "Menu.h"
   5          #include "Keys.h"
   6          #include "memory.h"
   7          #include "TM1722.h"
   8          #include "lcd.h"
   9          #include "KB4815.h"
  10          #include "uart.h"
  11          
  12          #include "handler.h"
  13          #include "MenuEvent.h"
  14          #include "CB_Line.h"
  15          
  16          extern tCbParam   mCbParam;                 //需要发送到CB机的数据
  17          extern tSqParam   mSqParam;                 //SQ模式
  18          extern tHmSetting  mHmSetting;               //手咪上面需要设置的数据
  19          extern isButtonTone;
  20          extern tSysParam    mSysParam;                //
  21          extern tFlag        mFlag;                    //
  22          extern tMenu mMenu;   
  23          
  24          extern u8 key_CombleFAF;
  25          extern u8 key_CombleFUPAFRFGSCAN;
  26          extern u8 key_CombleFUPEMG;
  27          extern u8 key_CombleSQSet;
  28          
  29          extern u8 key_UnLockcount;
  30          
  31          
  32          u8 key_SQSetIndex=0;
  33          u8 reStartScan=0;
  34          void checkChannel()
  35          {
  36   1        mSysParam.MinChannel = 1;
  37   1        switch(mCbParam.Country)
  38   1        {
  39   2          case COUNTRY_EU: mSysParam.MaxChannel = 40;mCbParam.Band=0;break;
  40   2          case COUNTRY_CE: mSysParam.MaxChannel = 40;mCbParam.Band=0;break;
  41   2          case COUNTRY_UK: mSysParam.MaxChannel = 40;mCbParam.Band=0;break;
  42   2          case COUNTRY_PL: mSysParam.MaxChannel = 40;mCbParam.Band=0;break;
  43   2          case COUNTRY_I0: mSysParam.MaxChannel = 40;mCbParam.Band=0;break;
  44   2          case COUNTRY_AU: mSysParam.MaxChannel = 40;mCbParam.Band=0;break;
  45   2          case COUNTRY_NL: mSysParam.MaxChannel = 40;mCbParam.Band=0;break;
  46   2          case COUNTRY_RU:
  47   2          {   
  48   3            if(mCbParam.Band>9) mCbParam.Band=0;
  49   3            mSysParam.MaxChannel = 40;
  50   3          }
  51   2            break;
  52   2          case COUNTRY_PX: 
  53   2            {
  54   3              if(mCbParam.Band>9) mCbParam.Band=0;
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 2   

  55   3              mSysParam.MaxChannel = 40;
  56   3            }
  57   2            break;
  58   2          case COUNTRY_I2: mSysParam.MaxChannel = 34;mCbParam.Band=0;break;
  59   2          case COUNTRY_DE: mSysParam.MaxChannel = 80;mCbParam.Band=0;break;
  60   2          case COUNTRY_IN: mSysParam.MaxChannel = 27;mCbParam.Band=0;break;
  61   2          case COUNTRY_PC: mSysParam.MaxChannel = 50;mCbParam.Band=0;break;
  62   2          case COUNTRY_AM: mSysParam.MaxChannel = 10;mCbParam.Band=0;break;
  63   2        }
  64   1        if(mCbParam.Country==COUNTRY_DE&&mCbParam.Modu==AM)   mSysParam.MaxChannel=40;  
  65   1        else if((mCbParam.Country==COUNTRY_DE&&mCbParam.Modu==FM)) mSysParam.MaxChannel=80;
  66   1        
  67   1      }
  68          /*-------------------------------------------------------------------------
  69          *函数：CHANNEL_FUC  通道模式
  70          *参数：无  
  71          *返回值：无
  72          *-------------------------------------------------------------------------*/
  73          void CHANNEL_FUC()                    //通道模式
  74          { 
  75   1        ShowChannel();
  76   1      }
  77          
  78          void CHANNEL_SCAN_UP_FUC()
  79          { 
  80   1          mSqParam.ScanDir=1;
  81   1        mSqParam.HouldTime=0;
  82   1          if(mSqParam.ScanHould==2)
  83   1          {
  84   2            reStartScan=1;        
  85   2            
  86   2            mSysParam.Rssi=0;
  87   2          }
  88   1          //mSqParam.ScanHould=1;
  89   1      }
  90          void CHANNEL_SCAN_DN_FUC()
  91          {
  92   1        mSqParam.ScanDir=0;
  93   1        mSqParam.HouldTime=0;
  94   1        if(mSqParam.ScanHould==2)
  95   1          {
  96   2            reStartScan=1;        
  97   2            
  98   2            mSysParam.Rssi=0;
  99   2          }
 100   1      }
 101          
 102          /*-------------------------------------------------------------------------
 103          *函数：CHANNEL_UP_FUC  信道加
 104          *参数：无  
 105          *返回值：无
 106          *-------------------------------------------------------------------------*/
 107          void CHANNEL_UP_FUC()                 //信道加
 108          {
 109   1        u8 oldchannel=mCbParam.Channel;
 110   1        u8 oldband=mCbParam.Band;
 111   1        u8 oldmute=mCbParam.Modu;
 112   1        mSysParam.isLastChannel=2;
 113   1        
 114   1        checkChannel();
 115   1        
 116   1        if(mCbParam.Channel<mSysParam.MaxChannel)
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 3   

 117   1        {
 118   2          mCbParam.Channel++;
 119   2        }
 120   1        else    
 121   1        {
 122   2          if(mCbParam.Country==COUNTRY_DE&&mCbParam.Modu==AM)
 123   2          {
 124   3            mSysParam.MaxChannel=80;
 125   3            mCbParam.Channel=41;
 126   3            mCbParam.Modu=FM;
 127   3            /*
 128   3            if(!isSendCmdOK(CMD_SET_MODULATION))
 129   3            {
 130   3              mCbParam.Channel=40;
 131   3              mSysParam.MaxChannel=40;
 132   3              mCbParam.Modu=AM;
 133   3              mCbParam.Channel=oldchannel;  
 134   3              mCbParam.Band=oldband;    
 135   3              return;
 136   3            }
 137   3            */
 138   3          }
 139   2          else
 140   2          {
 141   3            if(mCbParam.Country==COUNTRY_RU||mCbParam.Country==COUNTRY_PX)
 142   3            {
 143   4              if(mCbParam.Band<9)mCbParam.Band++;
 144   4              else mCbParam.Band=0;
 145   4              /*
 146   4              if(!isSendCmdOK(CMD_SET_BAND))
 147   4              {
 148   4                mCbParam.Channel=oldchannel;  
 149   4                mCbParam.Band=oldband;          
 150   4              }
 151   4              else
 152   4              {
 153   4                mCbParam.Channel=mSysParam.MinChannel;
 154   4              }
 155   4              */
 156   4            }
 157   3            
 158   3            mCbParam.Channel=mSysParam.MinChannel;
 159   3            
 160   3          }
 161   2        }
 162   1      
 163   1       CheckTxPower();
 164   1        if((isSendCmdOK(CMD_SET_CHANNEL)))
 165   1        {     
 166   2          close_sq();
 167   2          mMenu.emgIndex=0;
 168   2          mSysParam.isLastChannel=0;    
 169   2          mSysParam.LastChannel=mCbParam.Channel;
 170   2          mSysParam.LastBand=mCbParam.Band;
 171   2          saveData(EEP_CHANNEL,mCbParam.Channel); 
 172   2          saveData(EEP_BAND,mCbParam.Band); 
 173   2          saveData(EEP_MODU,mCbParam.Modu);   
 174   2          ShowChannel();    
 175   2        }
 176   1        else
 177   1        {   
 178   2          mCbParam.Channel=oldchannel;  
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 4   

 179   2          mCbParam.Band=oldband;  
 180   2          if(mCbParam.Modu!=oldmute)
 181   2          {
 182   3            mCbParam.Modu=oldmute;
 183   3            mSysParam.MaxChannel=40;
 184   3          }
 185   2          lcdShowError();     
 186   2        } 
 187   1      }  
 188          /*-------------------------------------------------------------------------
 189          *函数：CHANNEL_LONGUP_FUC  信道连续加
 190          *参数：无  
 191          *返回值：无
 192          *-------------------------------------------------------------------------*/
 193          void CHANNEL_LONGUP_FUC()
 194          {
 195   1        u8 oldchannel=mCbParam.Channel;
 196   1        u8 oldband=mCbParam.Band;
 197   1        u8 oldmute=mCbParam.Modu;
 198   1        checkChannel();
 199   1        if(mCbParam.Country==COUNTRY_RU||mCbParam.Country==COUNTRY_PX)
 200   1        {
 201   2          if(mCbParam.Channel<(mSysParam.MaxChannel-10))    mCbParam.Channel+=10;
 202   2          else 
 203   2          {     
 204   3            if(mCbParam.Band<9)mCbParam.Band++;
 205   3            else mCbParam.Band=0;     
 206   3            mCbParam.Channel=mSysParam.MinChannel;
 207   3          }
 208   2        }
 209   1        else 
 210   1        {
 211   2          if(mCbParam.Channel<mSysParam.MaxChannel) mCbParam.Channel++;
 212   2          else 
 213   2          {
 214   3            if(mCbParam.Country==COUNTRY_DE&&mCbParam.Modu==AM)
 215   3            {
 216   4              mSysParam.MaxChannel=80;
 217   4              mCbParam.Channel=41;
 218   4              mCbParam.Modu=FM;
 219   4              //isSendCmdOK(CMD_SET_MODULATION);
 220   4            }
 221   3            else
 222   3            {
 223   4              if(mCbParam.Country==COUNTRY_RU||mCbParam.Country==COUNTRY_PX)
 224   4              {
 225   5                if(mCbParam.Band<9)mCbParam.Band++;
 226   5                else mCbParam.Band=0;
 227   5                mCbParam.Channel=mSysParam.MinChannel;
 228   5                /*
 229   5                if(!isSendCmdOK(CMD_SET_BAND))
 230   5                {
 231   5                  mCbParam.Channel=oldchannel;  
 232   5                  mCbParam.Band=oldband;          
 233   5                }
 234   5                else
 235   5                {
 236   5                  mCbParam.Channel=mSysParam.MinChannel;
 237   5                }
 238   5                */
 239   5              }
 240   4              
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 5   

 241   4              mCbParam.Channel=mSysParam.MinChannel;
 242   4              
 243   4            }
 244   3          }
 245   2        }
 246   1      CheckTxPower();
 247   1        if(isSendCmdOK(CMD_SET_CHANNEL))
 248   1        {
 249   2          close_sq();
 250   2          mSysParam.LastChannel=mCbParam.Channel;
 251   2          mSysParam.LastBand=mCbParam.Band;
 252   2          mSysParam.isLastChannel=0;
 253   2          mMenu.emgIndex=0;
 254   2          saveData(EEP_CHANNEL,mCbParam.Channel); 
 255   2          saveData(EEP_BAND,mCbParam.Band); 
 256   2          saveData(EEP_MODU,mCbParam.Modu); 
 257   2          ShowChannel();
 258   2        }
 259   1        else
 260   1        {   
 261   2          mCbParam.Channel=oldchannel;  
 262   2          mCbParam.Band=oldband;  
 263   2          if(mCbParam.Modu!=oldmute)
 264   2          {
 265   3            mCbParam.Modu=oldmute;
 266   3            mSysParam.MaxChannel=40;
 267   3          } 
 268   2          lcdShowError();
 269   2        } 
 270   1        ShowChannel();
 271   1        delayms(MENU_UP_DOWN_SPEED);
 272   1      }
 273          /*-------------------------------------------------------------------------
 274          *函数：CHANNEL_DN_FUC  信道减
 275          *参数：无  
 276          *返回值：无
 277          *-------------------------------------------------------------------------*/  
 278          void CHANNEL_DN_FUC()                 //信道减
 279          { 
 280   1        u8 oldchannel=mCbParam.Channel;
 281   1        u8 oldband=mCbParam.Band;
 282   1        mSysParam.isLastChannel=2;  
 283   1        if(mCbParam.Channel>mSysParam.MinChannel)
 284   1        {
 285   2          mCbParam.Channel--;
 286   2        }
 287   1        else 
 288   1        {
 289   2          checkChannel();
 290   2            if(mCbParam.Country==COUNTRY_RU||mCbParam.Country==COUNTRY_PX)
 291   2            {
 292   3              if(mCbParam.Band>0)mCbParam.Band--;
 293   3              else mCbParam.Band=9;
 294   3              mCbParam.Channel=mSysParam.MaxChannel;
 295   3              /*
 296   3              if(!isSendCmdOK(CMD_SET_BAND))
 297   3              {
 298   3                mCbParam.Channel=oldchannel;  
 299   3                mCbParam.Band=oldband;          
 300   3              }
 301   3              else
 302   3              {
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 6   

 303   3                mCbParam.Channel=mSysParam.MinChannel;
 304   3              }
 305   3              */
 306   3            }
 307   2            if(mCbParam.Country==COUNTRY_DE&&mCbParam.Modu==AM)mCbParam.Modu=FM ; 
 308   2        
 309   2            mCbParam.Channel=mSysParam.MaxChannel;
 310   2            
 311   2        }
 312   1      CheckTxPower();
 313   1        if(isSendCmdOK(CMD_SET_CHANNEL))
 314   1        {
 315   2          close_sq(); 
 316   2          
 317   2          mSysParam.LastChannel=mCbParam.Channel;
 318   2          mSysParam.LastBand=mCbParam.Band;
 319   2          mSysParam.isLastChannel=0;
 320   2             mMenu.emgIndex=0;
 321   2              saveData(EEP_CHANNEL,mCbParam.Channel); 
 322   2          saveData(EEP_BAND,mCbParam.Band); 
 323   2          saveData(EEP_MODU,mCbParam.Modu); 
 324   2              ShowChannel();
 325   2            
 326   2        }   
 327   1        else
 328   1        {   
 329   2          mCbParam.Channel=oldchannel;  
 330   2          mCbParam.Band=oldband;
 331   2          lcdShowError();
 332   2        } 
 333   1        ShowChannel();
 334   1      }  
 335          /*-------------------------------------------------------------------------
 336          *函数：CHANNEL_LONGDN_FUC  信道连续减
 337          *参数：无  
 338          *返回值：无
 339          *-------------------------------------------------------------------------*/
 340          void CHANNEL_LONGDN_FUC()
 341          {
 342   1        u8 oldchannel=mCbParam.Channel;
 343   1        u8 oldband=mCbParam.Band;
 344   1        
 345   1        checkChannel();
 346   1        if(mCbParam.Country==COUNTRY_RU||mCbParam.Country==COUNTRY_PX)
 347   1        {
 348   2          if(mCbParam.Channel>10)   mCbParam.Channel-=10;
 349   2          else 
 350   2          {     
 351   3            if(mCbParam.Band>0)mCbParam.Band--;
 352   3            else mCbParam.Band=9;     
 353   3            mCbParam.Channel=mCbParam.Channel%10+30;
 354   3          } 
 355   2        }
 356   1        else 
 357   1        {
 358   2          if(mCbParam.Channel>mSysParam.MinChannel)   mCbParam.Channel--;
 359   2          else  mCbParam.Channel=mSysParam.MaxChannel;
 360   2        }
 361   1      CheckTxPower();
 362   1        if(isSendCmdOK(CMD_SET_CHANNEL))
 363   1        {
 364   2          close_sq();
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 7   

 365   2          mSysParam.LastChannel=mCbParam.Channel;
 366   2          mSysParam.LastBand=mCbParam.Band;
 367   2          mSysParam.isLastChannel=0;
 368   2          mMenu.emgIndex=0;
 369   2            saveData(EEP_CHANNEL,mCbParam.Channel); 
 370   2          saveData(EEP_BAND,mCbParam.Band); 
 371   2          saveData(EEP_MODU,mCbParam.Modu); 
 372   2              ShowChannel();    
 373   2                
 374   2        }
 375   1        else
 376   1        {   
 377   2          mCbParam.Channel=oldchannel;  
 378   2          mCbParam.Band=oldband;
 379   2          lcdShowError();
 380   2        } 
 381   1        ShowChannel();
 382   1        delayms(MENU_UP_DOWN_SPEED);
 383   1      }
 384          /*-------------------------------------------------------------------------
 385          *函数：CHANNEL_VOLUP_FUC  音量加
 386          *参数：无  
 387          *返回值：无
 388          *-------------------------------------------------------------------------*/
 389          void CHANNEL_VOLUP_FUC()              //音量加
 390          {
 391   1      
 392   1        if(mCbParam.VolLevel<9)
 393   1        {
 394   2          mCbParam.VolLevel++;
 395   2        }
 396   1        if(isSendCmdOK(CMD_SET_VOL))
 397   1        {   
 398   2          if(mFlag.SpkOpen==1&&mHmSetting.SpkerSwitch==1)
 399   2          {
 400   3            SPK_EN=1;
 401   3          }
 402   2          saveData(CMD_SET_VOL,mCbParam.VolLevel);
 403   2        }
 404   1        else
 405   1        {
 406   2          if(mCbParam.VolLevel>0)
 407   2          {
 408   3            mCbParam.VolLevel--;
 409   3          }
 410   2          if(mCbParam.VolLevel==0)
 411   2          {
 412   3            SPK_EN=0;
 413   3          }
 414   2          
 415   2        }
 416   1        ShowVol();
 417   1        delayms(MENU_UP_DOWN_SPEED);
 418   1      }
 419          /*-------------------------------------------------------------------------
 420          *函数：CHANNEL_VOLDN_FUC  音量减
 421          *参数：无  
 422          *返回值：无
 423          *-------------------------------------------------------------------------*/  
 424          void CHANNEL_VOLDN_FUC()              //音量减
 425          {
 426   1        
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 8   

 427   1        if(mCbParam.VolLevel>0)
 428   1        {
 429   2          mCbParam.VolLevel--;
 430   2        }
 431   1        if(isSendCmdOK(CMD_SET_VOL))
 432   1        {   
 433   2          saveData(CMD_SET_VOL,mCbParam.VolLevel);
 434   2          if(mCbParam.VolLevel==0)
 435   2          {
 436   3            SPK_EN=0;     
 437   3          }
 438   2          
 439   2        }
 440   1        else
 441   1        {
 442   2          if(mCbParam.VolLevel<9)
 443   2          {
 444   3            mCbParam.VolLevel++;
 445   3          }
 446   2        }
 447   1        
 448   1        ShowVol();
 449   1        
 450   1      delayms(MENU_UP_DOWN_SPEED);  
 451   1      }                   
 452          /*-------------------------------------------------------------------------
 453          *函数：CHANNEL_SQ_FUC  进入SQ等级设置
 454          *参数：无  
 455          *返回值：无
 456          *-------------------------------------------------------------------------*/
 457          void CHANNEL_SQ_FUC()                 //进入SQ等级设置
 458          {
 459   1        if(mSqParam.IsAsq==0)
 460   1        {
 461   2          ShowSq();
 462   2        }
 463   1        else ShowAsq();
 464   1        mFlag.InMainFace = 1;
 465   1      } 
 466          /*-------------------------------------------------------------------------
 467          *函数：CHANNEL_SQ_VOLUP_FUC  SQ等级加
 468          *参数：无  
 469          *返回值：无
 470          *-------------------------------------------------------------------------*/  
 471          void CHANNEL_SQ_VOLUP_FUC()           //SQ等级加
 472          {
 473   1        uchar temp1_sq;
 474   1        if(mSqParam.IsAsq==0)
 475   1        {
 476   2          temp1_sq=mCbParam.Sq;
 477   2          if(mSqParam.SqLevel<28)
 478   2          {
 479   3            mSqParam.SqLevel++;
 480   3          }
 481   2          mCbParam.Sq=mSqParam.SqLevel;
 482   2          if(!isSendCmdOK(CMD_SET_SQ_ASQ))    
 483   2          {
 484   3            if(mSqParam.SqLevel>0)
 485   3            {
 486   4              mSqParam.SqLevel--;
 487   4            }
 488   3            mCbParam.Sq=temp1_sq;
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 9   

 489   3          }
 490   2          saveData(EEP_SQ_LEVEL,mSqParam.SqLevel);
 491   2          ShowSq();
 492   2        }
 493   1        else 
 494   1        {
 495   2          temp1_sq=mCbParam.Sq;
 496   2          if(mSqParam.AsqLevel<5)
 497   2          {
 498   3            mSqParam.AsqLevel++;
 499   3          }
 500   2          mCbParam.Sq=mSqParam.AsqLevel|0x20;
 501   2          if(!isSendCmdOK(CMD_SET_SQ_ASQ))
 502   2          {
 503   3            if(mSqParam.AsqLevel>1)
 504   3            {
 505   4              mSqParam.AsqLevel--;
 506   4            }
 507   3            mCbParam.Sq =temp1_sq;
 508   3          }
 509   2          saveData(EEP_ASQ_LEVEL,mSqParam.AsqLevel);
 510   2          ShowAsq();
 511   2        }
 512   1        //isSendCmdOK(CMD_REQUEST_RSSI);
 513   1        delayms(MENU_UP_DOWN_SPEED);
 514   1      }
 515          /*-------------------------------------------------------------------------
 516          *函数：CHANNEL_SQ_VOLDN_FUC  SQ等级减
 517          *参数：无  
 518          *返回值：无
 519          *-------------------------------------------------------------------------*/  
 520          void CHANNEL_SQ_VOLDN_FUC()           //SQ等级减
 521          {
 522   1        uchar temp1_sq;
 523   1        temp1_sq=mCbParam.Sq;
 524   1        if(mSqParam.IsAsq==0)
 525   1        {
 526   2          
 527   2          if(mSqParam.SqLevel>0)
 528   2          {
 529   3            mSqParam.SqLevel--;
 530   3          }
 531   2          /*
 532   2          if(mSqParam.SqLevel==0)
 533   2          {
 534   2            SPK_EN=1;
 535   2            LED_RX=1;
 536   2            LCD_RX(1);
 537   2            mFlag.SpkOpen=1;
 538   2          }
 539   2          */
 540   2          mCbParam.Sq=mSqParam.SqLevel;
 541   2          if(!isSendCmdOK(CMD_SET_SQ_ASQ))    
 542   2          {
 543   3            if(mSqParam.SqLevel<28)
 544   3            {
 545   4              mSqParam.SqLevel++;
 546   4            }
 547   3            mCbParam.Sq=temp1_sq;
 548   3          }
 549   2          saveData(EEP_SQ_LEVEL,mSqParam.SqLevel);
 550   2          ShowSq();
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 10  

 551   2        }
 552   1        else 
 553   1        {
 554   2          if(mSqParam.AsqLevel>1)
 555   2          {
 556   3            mSqParam.AsqLevel--;
 557   3          }
 558   2          mCbParam.Sq=mSqParam.AsqLevel|0x20;
 559   2          if(!isSendCmdOK(CMD_SET_SQ_ASQ))
 560   2          {
 561   3            if(mSqParam.AsqLevel<5)
 562   3            {
 563   4              mSqParam.AsqLevel++;
 564   4            }
 565   3            mCbParam.Sq = temp1_sq;
 566   3          }
 567   2          saveData(EEP_ASQ_LEVEL,mSqParam.AsqLevel);
 568   2          ShowAsq();
 569   2        }
 570   1        //isSendCmdOK(CMD_REQUEST_RSSI);
 571   1        delayms(MENU_UP_DOWN_SPEED);
 572   1      }
 573          
 574          /*-------------------------------------------------------------------------
 575          *函数：CHANNEL_LONGSQ_FUC  进入ASQ等级设置
 576          *参数：无  
 577          *返回值：无
 578          *-------------------------------------------------------------------------*/
 579          void CHANNEL_LONGSQ_FUC()             //进入ASQ等级设置
 580          {
 581   1        
 582   1        if(mSqParam.IsAsq==0)
 583   1        {
 584   2          mSqParam.IsAsq=1;
 585   2          mCbParam.Sq=mSqParam.AsqLevel|0x20;
 586   2          if(!isSendCmdOK(CMD_SET_SQ_ASQ))
 587   2          {
 588   3            lcdShowError(); 
 589   3              
 590   3          }
 591   2          else saveData(EEP_IS_ASQ,mSqParam.IsAsq);   
 592   2        }
 593   1        else
 594   1        { 
 595   2          mSqParam.IsAsq=0;
 596   2          mCbParam.Sq=mSqParam.SqLevel;
 597   2          if(!isSendCmdOK(CMD_SET_SQ_ASQ))
 598   2          {
 599   3            lcdShowError();     
 600   3          }
 601   2          else  saveData(EEP_IS_ASQ,mSqParam.IsAsq);
 602   2        }
 603   1        ShowChannel();
 604   1      } 
 605          
 606          
 607          /*-------------------------------------------------------------------------
 608          *函数：CHANNEL_DW_FUC  双频守候
 609          *参数：无  
 610          *返回值：无
 611          *-------------------------------------------------------------------------*/
 612          void CHANNEL_DW_FUC()                 //双频守候
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 11  

 613          {
 614   1        
 615   1        switch(mSqParam.DWSet)
 616   1        {
 617   2          case 0:     
 618   2            mSysParam.DWChannel1=mCbParam.Channel;
 619   2            mSysParam.DWBand1=mCbParam.Band;
 620   2            mSysParam.DWModu1=mCbParam.Modu;
 621   2            mSqParam.DWSet=1;
 622   2            break;
 623   2          case 1:
 624   2            if(mSysParam.DWChannel1!=mCbParam.Channel||mSysParam.DWBand1!=mCbParam.Band||mSysParam.DWModu1!=mCbPara
             -m.Modu)
 625   2            {
 626   3              mSysParam.DWChannel2=mCbParam.Channel;
 627   3              mSysParam.DWBand2=mCbParam.Band;
 628   3              mSysParam.DWModu2=mCbParam.Modu;
 629   3              mSqParam.DWSet=2;
 630   3            }
 631   2            else if(mSysParam.DWChannel1==mCbParam.Channel&&mSysParam.DWBand1==mCbParam.Band)
 632   2            {
 633   3              mSqParam.DWSet=0;
 634   3              mMenu.MenuIndex=CHANNEL;
 635   3              ShowChannel();
 636   3            }
 637   2            break;
 638   2          case 2:
 639   2            mCbParam.Channel=mSysParam.DWChannel1;
 640   2            mCbParam.Band=mSysParam.DWBand1;
 641   2            mCbParam.Modu=mSysParam.DWModu1;
 642   2            mMenu.MenuIndex=CHANNEL;        
 643   2            CheckTxPower();
 644   2            if(isSendCmdOK(CMD_SET_ALL))
 645   2            {   
 646   3              //saveData(EEP_CHANNEL,mCbParam.Channel);
 647   3              //saveData(EEP_BAND,mCbParam.Band);
 648   3              ShowChannel();      
 649   3              mSqParam.DWSet=0;
 650   3              mSqParam.HouldTime=0;
 651   3            }
 652   2            else
 653   2            {       
 654   3              lcdShowError();
 655   3            } 
 656   2            ShowChannel();
 657   2            break;
 658   2          default:
 659   2            mSqParam.DWSet=0;
 660   2            break;
 661   2        }
 662   1      
 663   1      }
 664          /*-------------------------------------------------------------------------
 665          *函数：CHANNEL_SCAN_FUC  进入扫描模式
 666          *参数：无  
 667          *返回值：无
 668          *-------------------------------------------------------------------------*/
 669          void CHANNEL_SCAN_FUC()               //进入扫描模式
 670          { 
 671   1          
 672   1        if(mSqParam.Scan==1)
 673   1        {
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 12  

 674   2          mSqParam.Scan=2;
 675   2          mSqParam.HouldTime=0;
 676   2        }
 677   1        else mSqParam.Scan=0x01;
 678   1        if(mSqParam.ScanHould==0x02)          //是否停止
 679   1        {
 680   2          mSqParam.ScanHould=0x01;    
 681   2        }
 682   1      }
 683          /*-------------------------------------------------------------------------
 684          *函数：CHANNEL_SCAN_SCAN_FUC  退出扫描模式
 685          *参数：无  
 686          *返回值：无
 687          *-------------------------------------------------------------------------*/
 688          void CHANNEL_SCAN_SCAN_FUC()   //退出扫描模式
 689          {
 690   1        mSqParam.Scan=1;
 691   1        mMenu.MenuIndex=CHANNEL;
 692   1        ShowChannel();
 693   1        //saveAllParam();
 694   1        //saveMenuParam();
 695   1        mMenu.Back_Channel_Time=BACK_TIME;
 696   1        mFlag.InMainFace = 0;
 697   1      
 698   1        delayms(MENU_UP_DOWN_SPEED);
 699   1      }
 700          /*-------------------------------------------------------------------------
 701          *函数：CHANNEL_PPTDN_FUC  发射
 702          *参数：无  
 703          *返回值：无
 704          *-------------------------------------------------------------------------*/
 705          void CHANNEL_PPTDN_FUC()            //发射
 706          {
 707   1        if(mMenu.isTx==0)
 708   1        {   
 709   2          while(PPT_KEY==0&&mMenu.isTx==0)
 710   2          {
 711   3            if(mFlag.SysMode == SYS_MODE_LINE)
 712   3            {
 713   4              
 714   4                if(isSendCmdOK(CMD_TRANSMIT))
 715   4                {     
 716   5                  SPK_EN=0;
 717   5                  
 718   5                  if(mCbParam.LastChannel!=mCbParam.Channel||mCbParam.LastBand!=mCbParam.Band)
 719   5                  {
 720   6                    mSysParam.isLastChannel=0;
 721   6                    mSysParam.BackChannel=mCbParam.LastChannel;
 722   6                    mSysParam.BackBand=mCbParam.LastBand;
 723   6                    mCbParam.LastChannel=mCbParam.Channel;
 724   6                    mCbParam.LastBand=mCbParam.Band;
 725   6                  }
 726   5                  if(mSqParam.Scan==2) mSqParam.ScanHould=2;
 727   5                  if(mSqParam.DWSet==2)mSqParam.DWHould=2;  
 728   5                  ShowChannel();
 729   5                  LCD_TX(1);  
 730   5                  
 731   5                  if(mCbParam.TxPower==POWER_HIGH)    LCD_STRENGTH(5);  
 732   5                  else LCD_STRENGTH(3); 
 733   5                  EN_MIC = 1;
 734   5                  LED_TX = 1;         
 735   5                  mMenu.isTx=1;   
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 13  

 736   5                  SPK_EN=0;
 737   5                  LED_RX = 0;
 738   5                  LCD_RX(0);
 739   5                }             
 740   4            }
 741   3            else
 742   3            {     
 743   4              if(mFlag.SpkOpen == 0)
 744   4              {
 745   5                mMenu.isTx=1;   
 746   5            
 747   5                StartBK4815TX();
 748   5                SPK_EN=0;
 749   5                LED_RX = 0;
 750   5                LCD_RX(0);
 751   5              }         
 752   4            }
 753   3          }
 754   2        }
 755   1        TM1722_SHOW();
 756   1      }
 757          /*-------------------------------------------------------------------------
 758          *函数：CHANNEL_PPTUP_FUC  停止发射
 759          *参数：无  
 760          *返回值：无
 761          *-------------------------------------------------------------------------*/  
 762          void CHANNEL_PPTUP_FUC()           //停止发射
 763          {
 764   1        if(mMenu.isTx==1)
 765   1        {
 766   2          
 767   2          while(mMenu.isTx==1)
 768   2          {
 769   3            if(mFlag.SysMode == SYS_MODE_LINE)
 770   3            {
 771   4              if(isSendCmdOK(CMD_RECEIVE))
 772   4              {
 773   5                delayms(50);
 774   5                if(isSendCmdOK(CMD_RECEIVE))
 775   5                {
 776   6                  LCD_TX(0);
 777   6                  LCD_STRENGTH(0);
 778   6                  close_sq();
 779   6                  mFlag.SpkOpen = 0;
 780   6                  saveData(EEP_CHANNEL,mCbParam.Channel);
 781   6                  saveData(EEP_BAND,mCbParam.Band);
 782   6                  ShowChannel();  
 783   6                  EN_MIC = 0;
 784   6                  LED_TX = 0; 
 785   6                  mMenu.isTx=0;   
 786   6                }           
 787   5              } 
 788   4            }
 789   3            else
 790   3            {
 791   4              
 792   4              EN_MIC = 0;
 793   4              LCD_TX(0);
 794   4              LCD_STRENGTH(0);
 795   4              LED_TX = 0; 
 796   4              EnterBK4815RX();  
 797   4              mMenu.isTx=0;       
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 14  

 798   4            } 
 799   3          }
 800   2        }
 801   1        TM1722_SHOW();
 802   1        delayms(100);
 803   1      
 804   1      }
 805          /*-------------------------------------------------------------------------
 806          *函数：CHANNEL_AF_FUC  切换AM/FM
 807          *参数：无  
 808          *返回值：无
 809          *-------------------------------------------------------------------------*/
 810          void CHANNEL_AF_FUC()                 //切换AM/FM
 811          {
 812   1        u8 oldchannel=mCbParam.Channel;
 813   1        u8 oldband=mCbParam.Band;
 814   1        u8 oldmodu=mCbParam.Modu;
 815   1        
 816   1        if(mCbParam.Country==COUNTRY_EU||               \
 817   1           mCbParam.Country==COUNTRY_PL||               \
 818   1           mCbParam.Country==COUNTRY_I0||               \
 819   1           mCbParam.Country==COUNTRY_I2||               \
 820   1           (mCbParam.Country==COUNTRY_DE&&mCbParam.Channel<41)||               \
 821   1           mCbParam.Country==COUNTRY_IN||               \
 822   1           mCbParam.Country==COUNTRY_RU||               \
 823   1           mCbParam.Country==COUNTRY_PC||               \
 824   1           mCbParam.Country==COUNTRY_PX                 \
 825   1          )
 826   1        {
 827   2          
 828   2          if(mCbParam.Modu==FM)
 829   2          {
 830   3            mCbParam.Modu=AM;
 831   3            CheckTxPower();
 832   3            if(!isSendCmdOK(CMD_SET_MODULATION))
 833   3            {
 834   4              mCbParam.Modu=FM; 
 835   4            }
 836   3          
 837   3          }
 838   2          else
 839   2          {   
 840   3            mCbParam.Modu=FM;
 841   3            CheckTxPower();
 842   3            if(!isSendCmdOK(CMD_SET_MODULATION))
 843   3            {     
 844   4              mCbParam.Modu=AM;   
 845   4            }
 846   3          }
 847   2          if(mSqParam.DWSet==2)
 848   2          {
 849   3            mSqParam.DWHould=1;
 850   3          }
 851   2          saveData(EEP_MODU,mCbParam.Modu); 
 852   2        }
 853   1        else if((mCbParam.Country==COUNTRY_DE&&mCbParam.Channel>40))
 854   1        {
 855   2        }
 856   1        else
 857   1        {   
 858   2          if(mSysParam.isLastChannel==0&&mSqParam.DWSet!=2)
 859   2          {
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 15  

 860   3            if(mCbParam.Channel==mCbParam.LastChannel&& mCbParam.Band==mCbParam.LastBand)
 861   3            {
 862   4              mCbParam.Channel=mSysParam.BackChannel;
 863   4              mCbParam.Band=mSysParam.BackBand;
 864   4              CheckTxPower();
 865   4              if((isSendCmdOK(CMD_SET_CHANNEL)))
 866   4              {   
 867   5                mMenu.emgIndex=0;
 868   5                mSysParam.isLastChannel=2;    
 869   5                saveData(EEP_CHANNEL,mCbParam.Channel); 
 870   5                saveData(EEP_BAND,mCbParam.Band); 
 871   5                saveData(EEP_MODU,mCbParam.Modu);
 872   5                          
 873   5              }
 874   4              else
 875   4              {
 876   5                mCbParam.Channel=oldchannel;  
 877   5                mCbParam.Band=oldband;  
 878   5              } 
 879   4              
 880   4            }
 881   3            else
 882   3            {
 883   4              mSysParam.LastChannel=mCbParam.Channel;
 884   4              mSysParam.LastBand=mCbParam.Band; 
 885   4              mCbParam.Channel=mCbParam.LastChannel;
 886   4              mCbParam.Band=mCbParam.LastBand;
 887   4                    
 888   4              CheckTxPower();
 889   4              if((isSendCmdOK(CMD_SET_CHANNEL)))
 890   4              {   
 891   5                mMenu.emgIndex=0;
 892   5                mSysParam.isLastChannel=1;        
 893   5                saveData(EEP_CHANNEL,mCbParam.Channel); 
 894   5                saveData(EEP_BAND,mCbParam.Band); 
 895   5                saveData(EEP_MODU,mCbParam.Modu);
 896   5              }
 897   4              else
 898   4              {
 899   5                mCbParam.Channel=oldchannel;  
 900   5                mCbParam.Band=oldband;
 901   5              } 
 902   4            }
 903   3          }
 904   2          else if(mSysParam.isLastChannel==1)
 905   2          {
 906   3            mCbParam.Channel=mSysParam.LastChannel;
 907   3            mCbParam.Band=mSysParam.LastBand;
 908   3            CheckTxPower();
 909   3            if((isSendCmdOK(CMD_SET_CHANNEL)))
 910   3            {   
 911   4              mMenu.emgIndex=0;
 912   4              mSysParam.isLastChannel=1;
 913   4              saveData(EEP_CHANNEL,mCbParam.Channel); 
 914   4                saveData(EEP_BAND,mCbParam.Band); 
 915   4                saveData(EEP_MODU,mCbParam.Modu);
 916   4              ShowChannel();  
 917   4              mSysParam.isLastChannel=0;        
 918   4            }
 919   3            else
 920   3            {
 921   4                mCbParam.Channel=oldchannel;  
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 16  

 922   4                mCbParam.Band=oldband;
 923   4            } 
 924   3          }
 925   2          else if(mSysParam.isLastChannel==2)
 926   2          {
 927   3            mCbParam.Channel=mCbParam.LastChannel;
 928   3            mCbParam.Band=mCbParam.LastBand;
 929   3            CheckTxPower();
 930   3            if((isSendCmdOK(CMD_SET_CHANNEL)))
 931   3            {   
 932   4              mMenu.emgIndex=0;
 933   4              mSysParam.isLastChannel=0;  
 934   4              saveData(EEP_CHANNEL,mCbParam.Channel); 
 935   4                saveData(EEP_BAND,mCbParam.Band); 
 936   4                saveData(EEP_MODU,mCbParam.Modu);
 937   4                        
 938   4            }
 939   3            else
 940   3            {
 941   4              mCbParam.Channel=oldchannel;  
 942   4              mCbParam.Band=oldband;
 943   4            } 
 944   3          }
 945   2        }
 946   1        ShowChannel();
 947   1        delayms(MENU_UP_DOWN_SPEED);
 948   1      }
 949          /*-------------------------------------------------------------------------
 950          *函数：CHANNEL_LONG_AF_FUC  长按回到CE频段
 951          *参数：无  
 952          *返回值：无
 953          *-------------------------------------------------------------------------*/
 954          void CHANNEL_LONG_AF_FUC()
 955          {
 956   1        u8 oldchannel=0;
 957   1        if(mCbParam.Country==COUNTRY_UK)
 958   1        {
 959   2          playButtonTone();
 960   2          mCbParam.Country=COUNTRY_CE;
 961   2          oldchannel=mCbParam.Channel;
 962   2          mCbParam.Channel=9;
 963   2          if(isSendCmdOK(CMD_SET_ALL))
 964   2          {   
 965   3            LCD_CLEAR();
 966   3            ShowContry(mCbParam.Country);
 967   3            delayms(POWER_ON_SHOW_CONTRY);
 968   3            LCD_CLEAR();  
 969   3            mSysParam.isUK=1;     
 970   3            ShowChannel();  
 971   3          }
 972   2          else 
 973   2          {
 974   3            mCbParam.Country=COUNTRY_UK;
 975   3            mCbParam.Channel=oldchannel;      
 976   3          }
 977   2        }
 978   1        else if(mCbParam.Country==COUNTRY_CE&&mSysParam.isUK==1)
 979   1        {
 980   2          playButtonTone();
 981   2          mCbParam.Country=COUNTRY_UK;
 982   2          oldchannel=mCbParam.Channel;
 983   2          mCbParam.Channel=9;
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 17  

 984   2          if(isSendCmdOK(CMD_SET_ALL))
 985   2          {
 986   3            close_sq();
 987   3            mSysParam.isUK=0;
 988   3            LCD_CLEAR();      
 989   3            ShowContry(mCbParam.Country);
 990   3            delayms(POWER_ON_SHOW_CONTRY);
 991   3            LCD_CLEAR();      
 992   3            ShowChannel();  
 993   3          }
 994   2          else 
 995   2          {
 996   3            mCbParam.Country=COUNTRY_UK;
 997   3            mCbParam.Channel=oldchannel;      
 998   3          }
 999   2        }
1000   1        CheckTxPower();
1001   1      }
1002          /*-------------------------------------------------------------------------
1003          *函数：CHANNEL_FAF_FUC  组合按键
1004          *参数：无  
1005          *返回值：无
1006          *-------------------------------------------------------------------------*/
1007          void CHANNEL_FAF_FUC()
1008          {
1009   1        u8 i;
1010   1        for(i=0;i<3;i++)
1011   1        {   
1012   2          LED_TX=1;   
1013   2          delayms(70);
1014   2          LED_TX=0;   
1015   2          delayms(70);
1016   2        }
1017   1        LCD_CLEAR();
1018   1        saveData(EEP_COUNTRY_TB,mCbParam.CountryTable);
1019   1        switch(mCbParam.CountryTable)
1020   1        {
1021   2          case 1:
1022   2            if(mCbParam.Country>7)mCbParam.Country=0;
1023   2            break;
1024   2          case 2:
1025   2            if(mCbParam.Country>10)mCbParam.Country=0;
1026   2            break;
1027   2          case 3:
1028   2            if(mCbParam.Country<11)mCbParam.Country=11;
1029   2            break;
1030   2          default:
1031   2            break;
1032   2        }
1033   1        ShowContry(mCbParam.Country); 
1034   1      }
1035          /*-------------------------------------------------------------------------
1036          *函数：CHANNEL_RFG_FUC  进入RF GAIN等级设置
1037          *参数：无  
1038          *返回值：无
1039          *-------------------------------------------------------------------------*/
1040          void CHANNEL_RFG_FUC()                //进入RF GAIN等级设置
1041          { 
1042   1        delayms(MENU_UP_DOWN_SPEED);
1043   1        ShowRfg();  
1044   1      }
1045          /*-------------------------------------------------------------------------
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 18  

1046          *函数：CHANNEL_RFG_UP_FUC  RF GAIN 加
1047          *参数：无  
1048          *返回值：无
1049          *-------------------------------------------------------------------------*/
1050          void CHANNEL_RFG_UP_FUC()             //RF GAIN 加
1051          {
1052   1        
1053   1        if(mCbParam.RfgLevel<9)
1054   1        {
1055   2          mCbParam.RfgLevel+=1;
1056   2        }
1057   1        else mCbParam.RfgLevel=0;
1058   1        if(isSendCmdOK(CMD_SET_RFG))
1059   1        {
1060   2          saveData(CMD_SET_RFG,mCbParam.RfgLevel);
1061   2        }
1062   1        else 
1063   1        {
1064   2          if(mCbParam.RfgLevel>0) mCbParam.RfgLevel-=1;
1065   2        }
1066   1        ShowRfg();
1067   1        delayms(MENU_UP_DOWN_SPEED);
1068   1      }
1069          /*-------------------------------------------------------------------------
1070          *函数：CHANNEL_RFG_DN_FUC  RF GAIN 减
1071          *参数：无  
1072          *返回值：无
1073          *-------------------------------------------------------------------------*/
1074          void CHANNEL_RFG_DN_FUC()             //RF GAIN 减
1075          {
1076   1        
1077   1        if(mCbParam.RfgLevel>0)
1078   1        {
1079   2          mCbParam.RfgLevel-=1;
1080   2        }
1081   1        else mCbParam.RfgLevel=9;
1082   1        if(isSendCmdOK(CMD_SET_RFG))
1083   1        {
1084   2          saveData(CMD_SET_RFG,mCbParam.RfgLevel);
1085   2        }
1086   1        else 
1087   1        {
1088   2          if(mCbParam.RfgLevel<9) mCbParam.RfgLevel+=1;
1089   2        }
1090   1        ShowRfg();
1091   1        delayms(MENU_UP_DOWN_SPEED);
1092   1      }
1093          /*-------------------------------------------------------------------------
1094          *函数：CHANNEL_EMG  紧急信道
1095          *参数：无  
1096          *返回值：无
1097          *-------------------------------------------------------------------------*/
1098          void CHANNEL_EMG_FUC()                //紧急信道
1099          {
1100   1        u8 oldchannel;
1101   1        u8 oldband;
1102   1        oldchannel=mCbParam.Channel;
1103   1        oldband=mCbParam.Band;
1104   1        switch(mMenu.emgIndex)
1105   1        {
1106   2          case 0:
1107   2            if(mCbParam.Country==COUNTRY_AM)mMenu.emgIndex++;     
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 19  

1108   2            mMenu.emgIndex++;
1109   2            mCbParam.forEMGChannel=mCbParam.Channel;
1110   2            
1111   2            if(mCbParam.Country==COUNTRY_AM)  mCbParam.Channel=5;   
1112   2            else mCbParam.Channel=9;
1113   2            
1114   2            break;
1115   2          case 1:mMenu.emgIndex++;      
1116   2            mCbParam.Channel=19;
1117   2           
1118   2            break;
1119   2          case 2:mMenu.emgIndex=0;
1120   2          
1121   2            mCbParam.Channel=mCbParam.forEMGChannel;
1122   2          break;
1123   2        }
1124   1          CheckTxPower();
1125   1        if(isSendCmdOK(CMD_SET_ALL))
1126   1        {
1127   2          
1128   2              saveData(EEP_CHANNEL,mCbParam.Channel); 
1129   2                saveData(EEP_BAND,mCbParam.Band); 
1130   2                saveData(EEP_MODU,mCbParam.Modu);
1131   2              ShowChannel();      
1132   2        }
1133   1        else
1134   1        {   
1135   2          mCbParam.Channel=oldchannel;  
1136   2          mCbParam.Band=oldband;
1137   2          lcdShowError();
1138   2        } 
1139   1        
1140   1        ShowChannel();
1141   1      }
1142          /*-------------------------------------------------------------------------
1143          *函数：CHANNEL_DOUBLEF  进入锁键状态
1144          *参数：无  
1145          *返回值：无
1146          *-------------------------------------------------------------------------*/
1147          void CHANNEL_DOUBLEF_FUC()            //进入锁键状态
1148          {
1149   1        if(mMenu.isLock==0)
1150   1        {
1151   2          mMenu.isLock=1;
1152   2          LCD_LOCK(1);
1153   2        }
1154   1        else
1155   1        {
1156   2          mMenu.isLock=0;
1157   2          LCD_LOCK(0);
1158   2        }
1159   1      }
1160          /*-------------------------------------------------------------------------
1161          *函数：CHANNEL_LONGF_PB_FUC  进入菜单模式 PB 按键音
1162          *参数：无  
1163          *返回值：无
1164          *-------------------------------------------------------------------------*/
1165          void CHANNEL_LONGF_PB_FUC()           //进入菜单模式 PB 按键音
1166          {
1167   1        ShowBP();
1168   1      }
1169          /*-------------------------------------------------------------------------
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 20  

1170          *函数：CHANNEL_LONGF_PB_UP  PB ON和OF切换
1171          *参数：无  
1172          *返回值：无
1173          *-------------------------------------------------------------------------*/
1174          void CHANNEL_LONGF_PB_UP_FUC()        //PB ON和OF切换
1175          {
1176   1        
1177   1        if(mHmSetting.ButtonLedSwitch==ON)
1178   1        {
1179   2          mHmSetting.ButtonLedSwitch=OFF;
1180   2        }
1181   1        else mHmSetting.ButtonLedSwitch=ON;
1182   1        saveData(EEP_LED_SW,mHmSetting.ButtonLedSwitch);
1183   1        ShowBP();
1184   1        delayms(MENU_UP_DOWN_SPEED);
1185   1      }
1186          /*-------------------------------------------------------------------------
1187          *函数：CHANNEL_LONGF_PB_DN  PB ON和OF切换
1188          *参数：无  
1189          *返回值：无
1190          *-------------------------------------------------------------------------*/
1191          void CHANNEL_LONGF_PB_DN_FUC()        //PB ON和OF切换
1192          { 
1193   1        if(mHmSetting.ButtonLedSwitch==ON)
1194   1        {
1195   2          mHmSetting.ButtonLedSwitch=OFF;
1196   2        }
1197   1        else mHmSetting.ButtonLedSwitch=ON;
1198   1        saveData(EEP_LED_SW,mHmSetting.ButtonLedSwitch);
1199   1        ShowBP();
1200   1        delayms(MENU_UP_DOWN_SPEED);
1201   1      }
1202          /*-------------------------------------------------------------------------
1203          *函数：CHANNEL_LONGF_F_FC  菜单切换到FC LCD颜色切换
1204          *参数：无  
1205          *返回值：无
1206          *-------------------------------------------------------------------------*/
1207          void CHANNEL_LONGF_F_F_FC_FUC()         //菜单切换到FC LCD颜色切换
1208          {
1209   1         ShowFC();
1210   1      }
1211          /*-------------------------------------------------------------------------
1212          *函数：CHANNEL_LONGF_F_FC_UP  LCD颜色切换
1213          *参数：无  
1214          *返回值：无
1215          *-------------------------------------------------------------------------*/
1216          void CHANNEL_LONGF_F_F_FC_UP_FUC()      //LCD颜色切换
1217          {
1218   1      
1219   1        if(mHmSetting.LcdColor==7)
1220   1        {
1221   2          mHmSetting.LcdColor=0;
1222   2        }
1223   1        else mHmSetting.LcdColor++;
1224   1        saveData(EEP_LCD_COLOR,mHmSetting.LcdColor);
1225   1        ShowFC();
1226   1        delayms(MENU_UP_DOWN_SPEED);
1227   1      }
1228          /*-------------------------------------------------------------------------
1229          *函数：CHANNEL_LONGF_F_FC_DN  LCD颜色切换
1230          *参数：无  
1231          *返回值：无
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 21  

1232          *-------------------------------------------------------------------------*/
1233          void CHANNEL_LONGF_F_F_FC_DN_FUC()      //LCD颜色切换
1234          {
1235   1        delayms(MENU_UP_DOWN_SPEED);
1236   1        if(mHmSetting.LcdColor==0)
1237   1        {
1238   2          mHmSetting.LcdColor=7;
1239   2        }
1240   1        else mHmSetting.LcdColor--;
1241   1        saveData(EEP_LCD_COLOR,mHmSetting.LcdColor);
1242   1        ShowFC();
1243   1        delayms(MENU_UP_DOWN_SPEED);
1244   1      }
1245          /*-------------------------------------------------------------------------
1246          *函数：CHANNEL_LONGF_F_F_FL  菜单切换到FL 按键灯设置
1247          *参数：无  
1248          *返回值：无
1249          *-------------------------------------------------------------------------*/
1250          void CHANNEL_LONGF_F_FB_FUC()       //菜单切换到FL 按键灯设置
1251          {
1252   1        ShowFB();
1253   1      }
1254          /*-------------------------------------------------------------------------
1255          *函数：CHANNEL_LONGF_F_F_FL_UP_FUC  按键灯开关设置
1256          *参数：无  
1257          *返回值：无
1258          *-------------------------------------------------------------------------*/
1259          void CHANNEL_LONGF_F_FB_UP_FUC()    //按键灯开关设置
1260          {
1261   1        
1262   1        if(mHmSetting.ButtonToneSwitch==ON)
1263   1        {
1264   2          mHmSetting.ButtonToneSwitch=OFF;
1265   2        }
1266   1        else mHmSetting.ButtonToneSwitch=ON;
1267   1        saveData(EEP_TONE_SW,mHmSetting.ButtonToneSwitch);
1268   1        ShowFB();
1269   1        delayms(MENU_UP_DOWN_SPEED);
1270   1      }
1271          /*-------------------------------------------------------------------------
1272          *函数：CHANNEL_LONGF_F_F_FL_DN_FUC  按键灯开关设置
1273          *参数：无  
1274          *返回值：无
1275          *-------------------------------------------------------------------------*/
1276          void CHANNEL_LONGF_F_FB_DN_FUC()    //按键灯开关设置
1277          {
1278   1        
1279   1        if(mHmSetting.ButtonToneSwitch==ON)
1280   1        {
1281   2          mHmSetting.ButtonToneSwitch=OFF;
1282   2        }
1283   1        else mHmSetting.ButtonToneSwitch=ON;
1284   1        saveData(EEP_TONE_SW,mHmSetting.ButtonToneSwitch);
1285   1        ShowFB();
1286   1        delayms(MENU_UP_DOWN_SPEED);
1287   1      }
1288          /*-------------------------------------------------------------------------
1289          
1290          /*-------------------------------------------------------------------------
1291          *函数：CHANNEL_MENU_BACK_FUC  设置时按PPT返回
1292          *参数：无  
1293          *返回值：无
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 22  

1294          *-------------------------------------------------------------------------*/
1295          void CHANNEL_MENU_BACK_FUC()               //设置时按PPT返回
1296          {
1297   1        //mSqParam.Scan=1;
1298   1        mSqParam.ScanHould=1;
1299   1        //mSqParam.DWSet=0;
1300   1        mSqParam.DWHould=1;
1301   1        mMenu.MenuIndex=mMenu.BackMenuIndex;
1302   1        ShowChannel();
1303   1        if(mMenu.isLock==1) LCD_LOCK(1);
1304   1        saveAllParam();
1305   1        saveMenuParam();
1306   1        mMenu.Back_Channel_Time=BACK_TIME;
1307   1        mFlag.InMainFace = 0;
1308   1        while(PPT_KEY==0);
1309   1        delayms(MENU_UP_DOWN_SPEED);
1310   1        
1311   1      }
1312          /*-------------------------------------------------------------------------
1313          *函数：CHANNEL_DOUBLEMUTE_FUC  静音
1314          *参数：无  
1315          *返回值：无
1316          *-------------------------------------------------------------------------*/
1317          void CHANNEL_DOUBLEMUTE_FUC()
1318          {
1319   1        if(mSysParam.isMute==0)   mSysParam.isMute=1;
1320   1        else mSysParam.isMute=0;
1321   1          
1322   1        
1323   1        if(isSendCmdOK(CMD_MUTE))
1324   1        {
1325   2          if(mSysParam.isMute==0) 
1326   2          {
1327   3            LCD_NUM4(NUM4_OFF);
1328   3            if(mFlag.SpkOpen==1&&mHmSetting.SpkerSwitch==1)
1329   3            {
1330   4              SPK_EN=1;
1331   4            }
1332   3          }
1333   2          else 
1334   2          {
1335   3            LCD_NUM4(NUM4_M);
1336   3            if(isButtonTone==0x01)
1337   3            {
1338   4              SPK_EN=0;
1339   4            }
1340   3          }
1341   2        }
1342   1        else
1343   1        {
1344   2          if(mSysParam.isMute==0)   mSysParam.isMute=1;
1345   2          else mSysParam.isMute=0;
1346   2        }
1347   1        
1348   1        /*
1349   1        if(mHmSetting.SpkerSwitch==1)
1350   1        {
1351   1          mHmSetting.SpkerSwitch=0;
1352   1          LCD_NUM4(NUM4_M);
1353   1          SPK_EN=0;
1354   1        }
1355   1        else
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 23  

1356   1        { 
1357   1          LCD_NUM4(NUM4_OFF);
1358   1          mHmSetting.SpkerSwitch=1;
1359   1        }
1360   1        */
1361   1      }
1362          /*-------------------------------------------------------------------------
1363          *函数：CHANNEL_LONGPOWER_FUC  长按电源
1364          *参数：无  
1365          *返回值：无
1366          *-------------------------------------------------------------------------*/  
1367          void CHANNEL_LONGPOWER_FUC()
1368          {
1369   1          BK4815Sleep();
1370   1        IDLE
1371   1        LCD_CLEAR();
1372   1        TM1722_SHOW();
1373   1        LIGHT_B=0;
1374   1        LIGHT_G=0;
1375   1        LIGHT_R=0;
1376   1        LCD_LED=0;
1377   1        LED_TX=0;
1378   1        LED_RX=0;
1379   1        SPK_EN=0;
1380   1        saveAllParam();
1381   1        POW_OUT=0;
1382   1        
1383   1        while(1);
1384   1      }
1385          /*-------------------------------------------------------------------------
1386          *函数：CHANNEL_LOCK_PRESSOTHER_FUC  锁屏状态下 按其他按键
1387          *参数：无  
1388          *返回值：无
1389          *-------------------------------------------------------------------------*/  
1390          void CHANNEL_LOCK_PRESSOTHER_FUC()
1391          {
1392   1        u8 i;
1393   1        for(i=0;i<3;i++)
1394   1        {   
1395   2          LCD_LOCK(0);
1396   2          TM1722_SHOW();  
1397   2          delayms(70);
1398   2          LCD_LOCK(1);
1399   2          TM1722_SHOW();
1400   2          delayms(70);
1401   2        }
1402   1      }
1403          /*-------------------------------------------------------------------------
1404          *函数：CHANNEL_FAF_DN_FUC  国家减
1405          *参数：无  
1406          *返回值：无
1407          *-------------------------------------------------------------------------*/
1408          void CHANNEL_FAF_DN_FUC()
1409          {
1410   1        
1411   1        switch(mCbParam.CountryTable)
1412   1        {
1413   2          case 1:
1414   2            if(mCbParam.Country<7)  mCbParam.Country++;
1415   2            else mCbParam.Country=0;
1416   2            break;
1417   2          case 2:
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 24  

1418   2            if(mCbParam.Country<10) mCbParam.Country++;
1419   2            else mCbParam.Country=0;
1420   2            break;
1421   2          case 3:
1422   2            if(mCbParam.Country<13) mCbParam.Country++;
1423   2            else mCbParam.Country=11;
1424   2            break;
1425   2        }
1426   1        
1427   1        LCD_CLEAR();
1428   1        ShowContry(mCbParam.Country); 
1429   1        delayms(MENU_UP_DOWN_SPEED);
1430   1      }
1431          /*-------------------------------------------------------------------------
1432          *函数：CHANNEL_FAF_UP_FUC  国家加
1433          *参数：无
1434          *返回值：无
1435          *-------------------------------------------------------------------------*/
1436          void CHANNEL_FAF_UP_FUC()
1437          {
1438   1        
1439   1        switch(mCbParam.CountryTable)
1440   1        {
1441   2          case 1:
1442   2            if(mCbParam.Country>0)  mCbParam.Country--;
1443   2            else mCbParam.Country=7;
1444   2            break;
1445   2          case 2:
1446   2            if(mCbParam.Country>0)  mCbParam.Country--;
1447   2            else mCbParam.Country=10;
1448   2            break;
1449   2          case 3:
1450   2            if(mCbParam.Country>11) mCbParam.Country--;
1451   2            else mCbParam.Country=13;
1452   2            break;
1453   2        }
1454   1        LCD_CLEAR();
1455   1        ShowContry(mCbParam.Country); 
1456   1        delayms(MENU_UP_DOWN_SPEED);
1457   1      }
1458          /*-------------------------------------------------------------------------
1459          *函数：CHANNEL_FAF_PPT_FUC  保存国家设置
1460          *参数：无  
1461          *返回值：无
1462          *-------------------------------------------------------------------------*/
1463          void CHANNEL_FAF_PPT_FUC()
1464          {
1465   1        u8 i;
1466   1        for(i=0;i<3;i++)
1467   1        {   
1468   2          LED_TX=1;   
1469   2          delayms(70);
1470   2          LED_TX=0;   
1471   2          delayms(70);
1472   2        }
1473   1        if(
1474   1          mCbParam.Country==COUNTRY_AU||
1475   1          mCbParam.Country==COUNTRY_NL||
1476   1          mCbParam.Country==COUNTRY_AM
1477   1          )
1478   1        {
1479   2          mCbParam.Modu=AM;
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 25  

1480   2        }
1481   1        else mCbParam.Modu=FM;
1482   1        mCbParam.Channel=9;
1483   1        
1484   1        
1485   1          mSysParam.MinChannel = 1;
1486   1        switch(mCbParam.Country)
1487   1        {
1488   2          case COUNTRY_EU: mSysParam.MaxChannel = 40;break;
1489   2          case COUNTRY_CE: mSysParam.MaxChannel = 40;break;
1490   2          case COUNTRY_UK: mSysParam.MaxChannel = 40;break;
1491   2          case COUNTRY_PL: mSysParam.MaxChannel = 40;break;
1492   2          case COUNTRY_I0: mSysParam.MaxChannel = 40;break;
1493   2          case COUNTRY_AU: mSysParam.MaxChannel = 40;break;
1494   2          case COUNTRY_NL: mSysParam.MaxChannel = 40;break;
1495   2          case COUNTRY_RU: mSysParam.MaxChannel = 40;mCbParam.Band=3;break;
1496   2          case COUNTRY_PX: mSysParam.MaxChannel = 40;mCbParam.Band=3;break;
1497   2          case COUNTRY_I2: mSysParam.MaxChannel = 34;break;
1498   2          case COUNTRY_DE: mSysParam.MaxChannel = 80;break;
1499   2          case COUNTRY_IN: mSysParam.MaxChannel = 27;break;
1500   2          case COUNTRY_PC: mSysParam.MaxChannel = 50;break;
1501   2          case COUNTRY_AM: mSysParam.MaxChannel = 10;break;
1502   2        }
1503   1        if(mCbParam.Country==COUNTRY_AM) 
1504   1        {
1505   2          mSysParam.LastChannel=1;
1506   2          mSysParam.LastBand=mCbParam.Band;
1507   2          
1508   2          mCbParam.LastChannel=1; ;   
1509   2          mCbParam.LastBand=mCbParam.Band;
1510   2          
1511   2          mSysParam.BackChannel=1;
1512   2          mSysParam.BackBand=mCbParam.Band;
1513   2      
1514   2        }
1515   1        else
1516   1        {
1517   2          mSysParam.LastChannel=9;
1518   2          mSysParam.LastBand=mCbParam.Band;
1519   2        
1520   2          mCbParam.LastChannel=9; ;   
1521   2          mCbParam.LastBand=mCbParam.Band;
1522   2          
1523   2          mSysParam.BackChannel=9;
1524   2          mSysParam.BackBand=mCbParam.Band;
1525   2      
1526   2        }
1527   1        CheckTxPower();
1528   1        if(isSendCmdOK(CMD_SET_ALL))
1529   1        {   
1530   2          saveAllParam();
1531   2          InitMenu();
1532   2          LCD_CLEAR();
1533   2          ShowChannel();
1534   2          mSysParam.isUK=0;
1535   2        }
1536   1        else lcdShowError();
1537   1        mSysParam.isLastChannel=0;
1538   1      }
1539          /*-------------------------------------------------------------------------
1540          *函数：CHANNEL_TABLE_FUC  国家表设置界面
1541          *参数：无  
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 26  

1542          *返回值：无
1543          *-------------------------------------------------------------------------*/
1544          void CHANNEL_TABLE_FUC()
1545          {
1546   1        ShowTable();
1547   1      }
1548          /*-------------------------------------------------------------------------
1549          *函数：CHANNEL_FUPAFRFGSCAN_DN_FUC  国家表加
1550          *参数：无  
1551          *返回值：无
1552          *-------------------------------------------------------------------------*/
1553          void CHANNEL_FUPAFRFGSCAN_DN_FUC()
1554          { 
1555   1        if(mCbParam.CountryTable>1)
1556   1        {
1557   2          mCbParam.CountryTable--;
1558   2        }
1559   1        else mCbParam.CountryTable=3;
1560   1        //saveData(EEP_COUNTRY_TB,mCbParam.CountryTable);
1561   1        ShowTable();  
1562   1        delayms(MENU_UP_DOWN_SPEED);
1563   1      }
1564          /*-------------------------------------------------------------------------
1565          *函数：CHANNEL_FUPAFRFGSCAN_UP_FUC  国家表减
1566          *参数：无  
1567          *返回值：无
1568          *-------------------------------------------------------------------------*/
1569          void CHANNEL_FUPAFRFGSCAN_UP_FUC()
1570          {
1571   1        
1572   1        
1573   1        if(mCbParam.CountryTable<3)
1574   1        {
1575   2          mCbParam.CountryTable++;
1576   2        }
1577   1        else mCbParam.CountryTable=1;
1578   1        //saveData(EEP_COUNTRY_TB,mCbParam.CountryTable);
1579   1        ShowTable();  
1580   1        delayms(MENU_UP_DOWN_SPEED);
1581   1      }
1582          /*-------------------------------------------------------------------------
1583          *函数：CHANNEL_SQ_SET_FUC  SQ调节
1584          *参数：无  
1585          *返回值：无
1586          *-------------------------------------------------------------------------*/
1587          void CHANNEL_SQ_SET_FUC()
1588          {
1589   1        isSendCmdOK(CMD_REQUEST_SQ_SET);    
1590   1        ShowSQReSet();
1591   1      }
1592          /*-------------------------------------------------------------------------
1593          *函数：CHANNEL_SQ_SET_UP_FUC  SQ调节加键
1594          *参数：无  
1595          *返回值：无
1596          *-------------------------------------------------------------------------*/
1597          void CHANNEL_SQ_SET_UP_FUC()
1598          {
1599   1        uchar temp1_sq;
1600   1        switch(key_SQSetIndex)
1601   1        {
1602   2          case 0:   
1603   2            if(mSqParam.IsAsq==0)
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 27  

1604   2            {
1605   3              temp1_sq=mCbParam.Sq;
1606   3              if(mSqParam.SqLevel<28)
1607   3              {
1608   4                mSqParam.SqLevel++;
1609   4              }
1610   3              mCbParam.Sq=mSqParam.SqLevel;
1611   3              if(!isSendCmdOK(CMD_SET_SQ_ASQ))    
1612   3              {
1613   4                
1614   4                  if(mSqParam.SqLevel>0)
1615   4                  {
1616   5                    mSqParam.SqLevel--;
1617   5                  }
1618   4                  mCbParam.Sq=temp1_sq;
1619   4              }
1620   3              
1621   3            }
1622   2            else 
1623   2            {
1624   3              temp1_sq=mCbParam.Sq;
1625   3              if(mSqParam.AsqLevel<6)
1626   3              {
1627   4                mSqParam.AsqLevel++;
1628   4              }
1629   3              mCbParam.Sq=mSqParam.AsqLevel|0x20;
1630   3              if(!isSendCmdOK(CMD_SET_SQ_ASQ))
1631   3              {
1632   4                if(mSqParam.AsqLevel>1)
1633   4                {
1634   5                  mSqParam.AsqLevel--;
1635   5                }
1636   4                mCbParam.Sq =temp1_sq;
1637   4              
1638   4              }     
1639   3            }     
1640   2            isSendCmdOK(CMD_REQUEST_SQ_SET);
1641   2            break;
1642   2          case 1:
1643   2            if(mSqParam.OpenOrClose==0)mSqParam.OpenOrClose=1;
1644   2            else mSqParam.OpenOrClose=0;
1645   2            if(!isSendCmdOK(CMD_REQUEST_SQ_SET))
1646   2            {
1647   3                if(mSqParam.OpenOrClose==0)mSqParam.OpenOrClose=1;
1648   3                else mSqParam.OpenOrClose=0;
1649   3            }
1650   2            break;
1651   2          case 2:
1652   2              if(mSqParam.OpenOrClose==0)
1653   2              {
1654   3                if(mSqParam.OpenSet<20)
1655   3                mSqParam.OpenSet++;       
1656   3              }
1657   2              else
1658   2              {
1659   3                if(mSqParam.CloseSet<20)
1660   3                mSqParam.CloseSet++;  
1661   3              }
1662   2              if(!isSendCmdOK(CMD_SQ_SET))
1663   2              {
1664   3                  if(mSqParam.OpenOrClose==0)
1665   3                  {
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 28  

1666   4                    if(mSqParam.OpenSet>-20)
1667   4                    mSqParam.OpenSet--;       
1668   4                  }
1669   3                  else
1670   3                  {
1671   4                    if(mSqParam.CloseSet>-20)
1672   4                    mSqParam.CloseSet--;  
1673   4                  }
1674   3              }
1675   2            break;
1676   2        }
1677   1        ShowSQReSet();
1678   1        delayms(MENU_UP_DOWN_SPEED);
1679   1      }
1680          /*-------------------------------------------------------------------------
1681          *函数：CHANNEL_SQ_SET_DN_FUC  SQ调节减键
1682          *参数：无  
1683          *返回值：无
1684          *-------------------------------------------------------------------------*/
1685          void CHANNEL_SQ_SET_DN_FUC()
1686          {
1687   1          uchar temp1_sq;
1688   1        switch(key_SQSetIndex)
1689   1        {
1690   2          case 0:   
1691   2            if(mSqParam.IsAsq==0)
1692   2            {
1693   3              temp1_sq=mCbParam.Sq;
1694   3              if(mSqParam.SqLevel>1)
1695   3              {
1696   4                mSqParam.SqLevel--;
1697   4              }
1698   3              mCbParam.Sq=mSqParam.SqLevel;
1699   3              if(!isSendCmdOK(CMD_SET_SQ_ASQ))    
1700   3              {
1701   4                if(mSqParam.SqLevel<28)
1702   4                {
1703   5                  mSqParam.SqLevel++;
1704   5                }
1705   4                mCbParam.Sq=temp1_sq;
1706   4              } 
1707   3              isSendCmdOK(CMD_REQUEST_SQ_SET);
1708   3            }
1709   2            else 
1710   2            {
1711   3              temp1_sq=mCbParam.Sq;
1712   3              if(mSqParam.AsqLevel>1)
1713   3              {
1714   4                mSqParam.AsqLevel--;
1715   4              }
1716   3              mCbParam.Sq=mSqParam.AsqLevel|0x20;
1717   3              if(!isSendCmdOK(CMD_SET_SQ_ASQ))
1718   3              {
1719   4                if(mSqParam.AsqLevel<6)
1720   4                {
1721   5                  mSqParam.AsqLevel++;
1722   5                }
1723   4                mCbParam.Sq =temp1_sq;
1724   4              } 
1725   3              isSendCmdOK(CMD_REQUEST_SQ_SET);
1726   3            }     
1727   2            break;
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 29  

1728   2          case 1:
1729   2            if(mSqParam.OpenOrClose==0)mSqParam.OpenOrClose=1;
1730   2            else mSqParam.OpenOrClose=0;
1731   2            if(!isSendCmdOK(CMD_REQUEST_SQ_SET))
1732   2            {
1733   3                if(mSqParam.OpenOrClose==0)mSqParam.OpenOrClose=1;
1734   3                else mSqParam.OpenOrClose=0;
1735   3            }
1736   2            break;
1737   2          case 2:
1738   2              if(mSqParam.OpenOrClose==0)
1739   2              {
1740   3                if(mSqParam.OpenSet>-20)
1741   3                mSqParam.OpenSet--;       
1742   3              }
1743   2              else
1744   2              {
1745   3                if(mSqParam.CloseSet>-20)
1746   3                mSqParam.CloseSet--;  
1747   3              }
1748   2              if(!isSendCmdOK(CMD_SQ_SET))
1749   2              {
1750   3                  if(mSqParam.OpenOrClose==0)
1751   3                  {
1752   4                    if(mSqParam.OpenSet<20)
1753   4                    mSqParam.OpenSet++;       
1754   4                  }
1755   3                  else
1756   3                  {
1757   4                    if(mSqParam.CloseSet<20)
1758   4                    mSqParam.CloseSet++;  
1759   4                  }
1760   3              }
1761   2            
1762   2            break;
1763   2        }
1764   1        ShowSQReSet();
1765   1        delayms(MENU_UP_DOWN_SPEED);
1766   1      }
1767          /*-------------------------------------------------------------------------
1768          *函数：CHANNEL_SQ_SET_F_FUC  SQ调节切换设置对象
1769          *参数：无  
1770          *返回值：无
1771          *-------------------------------------------------------------------------*/
1772          void CHANNEL_SQ_SET_F_FUC()
1773          {
1774   1        switch(key_SQSetIndex)
1775   1        {
1776   2          case 0:key_SQSetIndex=1;
1777   2            break;
1778   2          case 1:key_SQSetIndex=2;
1779   2            break;
1780   2          case 2:key_SQSetIndex=0;
1781   2            break;
1782   2        }
1783   1        ShowSQReSet();
1784   1      }
1785          
1786          /*-------------------------------------------------------------------------
1787          *函数：CHANNEL_FRECAL_FUC  频偏调节
1788          *参数：无  
1789          *返回值：无
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 30  

1790          *-------------------------------------------------------------------------*/
1791          void CHANNEL_FRECAL_FUC()
1792          {
1793   1        ShowFreCalSet();
1794   1      }
1795          /*-------------------------------------------------------------------------
1796          *函数：CHANNEL_FRECAL_UP_FUC  频偏调节
1797          *参数：无  
1798          *返回值：无
1799          *-------------------------------------------------------------------------*/
1800          void CHANNEL_FRECAL_UP_FUC()
1801          {
1802   1        u8 oldfrecal=mCbParam.FreqCal;
1803   1        if(mCbParam.FreqCal<209)
1804   1        {
1805   2          mCbParam.FreqCal++;
1806   2        }
1807   1        if(!isSendCmdOK(CMD_SET_FREQ_CAL))
1808   1        {
1809   2          mCbParam.FreqCal=oldfrecal;
1810   2        }
1811   1        delayms(70);
1812   1      }
1813          /*-------------------------------------------------------------------------
1814          *函数：CHANNEL_FRECAL_DN_FUC  频偏调节
1815          *参数：无  
1816          *返回值：无
1817          *-------------------------------------------------------------------------*/
1818          void CHANNEL_FRECAL_DN_FUC()
1819          {
1820   1        u8 oldfrecal=mCbParam.FreqCal;
1821   1        if(mCbParam.FreqCal>11)   
1822   1        {
1823   2          mCbParam.FreqCal--;
1824   2        }
1825   1        if(!isSendCmdOK(CMD_SET_FREQ_CAL))
1826   1        {
1827   2          mCbParam.FreqCal=oldfrecal;
1828   2        }
1829   1        delayms(70);
1830   1      }
1831          
1832          /*-------------------------------------------------------------------------
1833          *函数：FACTORY_SETTING_FUC  出厂设置
1834          *参数：无  
1835          *返回值：无
1836          *-------------------------------------------------------------------------*/
1837          void FACTORY_SETTING_FUC()
1838          {
1839   1        
1840   1        key_CombleFAF=0;
1841   1        key_CombleFUPAFRFGSCAN=0;
1842   1        key_CombleFUPEMG=0;
1843   1        key_CombleSQSet=0;
1844   1        key_UnLockcount=0;
1845   1        mSqParam.Scan=1;
1846   1        mSqParam.DWSet=0;
1847   1      
1848   1        key_SQSetIndex=0;
1849   1        LCD_CLEAR();
1850   1        setDefaultParam();  
1851   1        saveAllParam(); 
C51 COMPILER V9.52.0.0   MENUEVENT                                                         06/02/2018 10:26:56 PAGE 31  

1852   1        ShowFactorySeting();
1853   1        ShowChannel();
1854   1          if(!isSendCmdOK(CMD_SET_ALL))
1855   1        {
1856   2            //LCD_CLEAR();
1857   2            LIGHT_B=0;
1858   2            LIGHT_G=0;
1859   2            LIGHT_R=0;
1860   2            LCD_LED=0;
1861   2            //PWR_MUTE_PRESS();         
1862   2        }
1863   1      }
1864          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   5743    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2      25
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MENU
OBJECT MODULE PLACED IN Menu.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Menu.c LARGE OPTIMIZE(6,SPEED) BROWSE INCDIR(G:\CB589P) DEBUG OBJECTEXTEND 
                    -TABS(2)

line level    source

   1          #include "system.h"
   2          #include "Menu.h"
   3          #include "Keys.h"
   4          #include "memory.h"
   5          #include "TM1722.h"
   6          #include "lcd.h"
   7          #include "KB4815.h"
   8          #include "uart.h"
   9          
  10          #include "handler.h"
  11          #include "MenuEvent.h"
  12          
  13          
  14          
  15          
  16          tMenu mMenu;                
  17          extern u8 ButtonLED;
  18          u8 key_CombleFAF=0;
  19          u8 key_CombleFUPAFRFGSCAN=0;
  20          u8 key_CombleFUPEMG=0;
  21          u8 key_CombleSQSet=0;
  22          u8 key_CombleFDN=0;
  23          u8 key_UnLockcount=0;
  24          
  25          /*--------------手麦4815默认设置--------------------*/
  26          extern float RX_Freq_Hand;
  27          extern u8 SqLeve_Hand;
  28          extern u8 scandwPPTPress;
  29          
  30          
  31          
  32          void MenuOperate(unsigned char key)
  33          {
  34   1        
  35   1         u8 i;
  36   1         mMenu.isBussy=1;
  37   1        
  38   1        
  39   1        if(key_CombleFAF==1&&key!=KEY_AF) key_CombleFAF=0;
  40   1        if(mMenu.MenuIndex!=CHANNEL_DOUBLEF)
  41   1        {
  42   2          if(key_CombleFUPAFRFGSCAN==1&&key!=KEY_UP) 
  43   2          { 
  44   3             key_CombleFUPAFRFGSCAN=0;
  45   3             mMenu.MenuIndex=CHANNEL; 
  46   3             CHANNEL_FUC();
  47   3          }
  48   2        }
  49   1        if(key_UnLockcount==1&&key!=KEY_F)key_UnLockcount=0;
  50   1        if(key_CombleFDN==1&&key!=KEY_DN)key_CombleFDN=0;
  51   1        if(key_CombleFUPAFRFGSCAN==2&&key!=KEY_AF) { key_CombleFUPAFRFGSCAN=0;mMenu.MenuIndex=CHANNEL;  CHANNEL_FU
             -C(); }  
  52   1        if(key_CombleFUPAFRFGSCAN==3&&key!=KEY_RFG) { key_CombleFUPAFRFGSCAN=0;mMenu.MenuIndex=CHANNEL; CHANNEL_F
             -UC(); }
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 2   

  53   1        if(key_CombleFUPAFRFGSCAN==4&&key!=KEY_SCAN) { key_CombleFUPAFRFGSCAN=0;mMenu.MenuIndex=CHANNEL;  CHANNEL_
             -FUC(); } 
  54   1        if(key_CombleFUPEMG==1&&key!=KEY_UP)  key_CombleFUPEMG=0;
  55   1        if(key_CombleFUPEMG==2&&key!=KEY_EMG)  key_CombleFUPEMG=0;
  56   1        
  57   1        if(key_CombleSQSet==1&&key!=KEY_SQ)  key_CombleSQSet=0;
  58   1        else if(key_CombleSQSet==2&&key!=KEY_SQ) key_CombleSQSet=0;
  59   1        else if(key_CombleSQSet==3&&key!=KEY_SQ) key_CombleSQSet=0;
  60   1        else if(key_CombleSQSet==4&&key!=KEY_SQ) key_CombleSQSet=0;
  61   1        else if(key_CombleSQSet==5&&key!=KEY_F) key_CombleSQSet=0;
  62   1      
  63   1        switch(mMenu.MenuIndex)
  64   1        {
  65   2          case CHANNEL:             //通道菜单            
  66   2            switch(key)
  67   2            {
  68   3              case KEY_AF:      
  69   3                playButtonTone();
  70   3                if(key_CombleFAF==1)  
  71   3                {
  72   4                  key_CombleFAF=0;
  73   4                  mMenu.MenuIndex=CHANNEL_FAF;
  74   4                  mMenu.BackMenuIndex=CHANNEL;
  75   4                  CHANNEL_FAF_FUC();            
  76   4                }
  77   3                else  CHANNEL_AF_FUC();
  78   3                if(key_CombleFUPAFRFGSCAN==2){key_CombleFUPAFRFGSCAN=3;mSysParam.KeyComboLimit=KEY_COMBOlIMIT;}         
  79   3                break;
  80   3              case KEY_LONG_AF:
  81   3                
  82   3                CHANNEL_LONG_AF_FUC();
  83   3                break;
  84   3              case KEY_RFG:
  85   3                playButtonTone();
  86   3                if(key_CombleFUPAFRFGSCAN==3){key_CombleFUPAFRFGSCAN=4;mSysParam.KeyComboLimit=KEY_COMBOlIMIT;}
  87   3                mMenu.MenuIndex=CHANNEL_RFG;
  88   3                mMenu.BackMenuIndex=CHANNEL;
  89   3                CHANNEL_RFG_FUC();
  90   3                break;
  91   3              case KEY_PPTUP:
  92   3                mMenu.MenuIndex=CHANNEL;
  93   3                CHANNEL_PPTUP_FUC();
  94   3                break;
  95   3              case KEY_DN:    
  96   3                playButtonTone();
  97   3                if(key_CombleFDN==1) 
  98   3                {
  99   4                  if(mHmSetting.SpkerSwitch==1)
 100   4                  {
 101   5                     mHmSetting.SpkerSwitch=0;
 102   5                    SPK_EN=0;
 103   5                  }
 104   4                  else
 105   4                  {           
 106   5                    mHmSetting.SpkerSwitch=1;
 107   5                  }
 108   4                  ShowSpeakSwitch();
 109   4                  delayms(400);
 110   4                  ShowChannel();
 111   4                  key_CombleFDN=0;
 112   4                }
 113   3                else  CHANNEL_DN_FUC();
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 3   

 114   3                break;        
 115   3              case KEY_LONGDN:
 116   3                playButtonTone();
 117   3                while(Get_AD(Key1)==0x0A)
 118   3                {
 119   4                  CHANNEL_LONGDN_FUC();
 120   4                }
 121   3                break;
 122   3              case KEY_UP:
 123   3                playButtonTone();
 124   3                if(key_CombleFUPAFRFGSCAN==1){key_CombleFUPAFRFGSCAN=2;mSysParam.KeyComboLimit=KEY_COMBOlIMIT;}
 125   3                if(key_CombleFUPEMG==1){key_CombleFUPEMG=2;mSysParam.KeyComboLimit=KEY_COMBOlIMIT;}
 126   3                CHANNEL_UP_FUC();
 127   3                break;
 128   3              case KEY_LONGUP:  
 129   3                playButtonTone();
 130   3                while(Get_AD(Key1)==0x0D)
 131   3                {
 132   4                  CHANNEL_LONGUP_FUC();
 133   4                }         
 134   3                break;
 135   3              case KEY_SQ:
 136   3                playButtonTone();
 137   3                switch(key_CombleSQSet)
 138   3               {
 139   4                 case 0: key_CombleSQSet=1;
 140   4                 mSysParam.KeyComboLimit=KEY_COMBOlIMIT;
 141   4                   mSysParam.isKeyCombo=1;
 142   4                   break;
 143   4                 case 1: key_CombleSQSet=2;
 144   4                 mSysParam.KeyComboLimit=KEY_COMBOlIMIT;
 145   4                   break;
 146   4                 case 2: key_CombleSQSet=3;
 147   4                 mSysParam.KeyComboLimit=KEY_COMBOlIMIT;
 148   4                   break;
 149   4                 case 3: key_CombleSQSet=4;
 150   4                 mSysParam.KeyComboLimit=KEY_COMBOlIMIT;
 151   4                   break;
 152   4                 case 4: key_CombleSQSet=5;
 153   4                 mSysParam.KeyComboLimit=KEY_COMBOlIMIT;
 154   4                   break;
 155   4                }
 156   3              
 157   3                mMenu.MenuIndex=CHANNEL_SQ;
 158   3                mMenu.BackMenuIndex=CHANNEL;
 159   3                CHANNEL_SQ_FUC();
 160   3                break;
 161   3              case KEY_LONG_SQ: 
 162   3                playButtonTone();
 163   3                CHANNEL_LONGSQ_FUC();
 164   3                break;
 165   3              case KEY_SCAN:    
 166   3                  if((mCbParam.Sq==0)||(mCbParam.Sq==0x20)) return;   
 167   3                  playButtonTone(); 
 168   3                  
 169   3                  mMenu.MenuIndex=CHANNEL_SCAN;
 170   3                  mMenu.BackMenuIndex=CHANNEL;
 171   3                  CHANNEL_SCAN_FUC();     
 172   3                  while(Get_AD(Key1)==0x0f);
 173   3                break;
 174   3              case KEY_VOL_UP:
 175   3                playButtonTone();
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 4   

 176   3                mMenu.MenuIndex=CHANNEL_VOL;
 177   3                mMenu.BackMenuIndex=CHANNEL;
 178   3                CHANNEL_VOLUP_FUC();
 179   3                break;        
 180   3              case KEY_VOL_DN:
 181   3                playButtonTone();
 182   3                mMenu.MenuIndex=CHANNEL_VOL;
 183   3                mMenu.BackMenuIndex=CHANNEL;
 184   3                CHANNEL_VOLDN_FUC();
 185   3                break;
 186   3              
 187   3              case KEY_F:   
 188   3                key_CombleFDN=1;
 189   3                key_CombleFAF=1;  
 190   3                key_CombleFUPAFRFGSCAN=1;
 191   3                key_CombleFUPEMG=1;
 192   3                mSysParam.isKeyCombo=1;
 193   3                mSysParam.KeyComboLimit=KEY_COMBOlIMIT;
 194   3        
 195   3                playButtonTone();
 196   3                if(key_UnLockcount==0) 
 197   3                {
 198   4                  key_UnLockcount=1;          
 199   4                }
 200   3                else if(key_UnLockcount==1) 
 201   3                {
 202   4                  mMenu.MenuIndex=CHANNEL_DOUBLEF;            
 203   4                  CHANNEL_DOUBLEF_FUC();
 204   4                  key_UnLockcount=0;          
 205   4                }
 206   3                else key_UnLockcount=0;
 207   3                
 208   3                break;
 209   3              case KEY_LONG_F:
 210   3                playButtonTone();
 211   3                mMenu.MenuIndex=CHANNEL_LONGF_PB;
 212   3                mMenu.BackMenuIndex=CHANNEL;
 213   3                CHANNEL_LONGF_PB_FUC();
 214   3                break;
 215   3              case KEY_DOUBLE_F:
 216   3                
 217   3                break;  
 218   3              case KEY_EMG:   
 219   3                
 220   3                playButtonTone();
 221   3                if(key_CombleFUPEMG==2)
 222   3                {
 223   4                  key_CombleFUPEMG=0;
 224   4                  FACTORY_SETTING_FUC();
 225   4                }
 226   3                else CHANNEL_EMG_FUC();
 227   3                break;
 228   3              
 229   3              case KEY_PPTDN:
 230   3                mMenu.MenuIndex=CHANNEL_PPTDN;
 231   3                mMenu.BackMenuIndex=CHANNEL;
 232   3                CHANNEL_PPTDN_FUC();
 233   3                break;        
 234   3              case KEY_MUTE:          
 235   3                break;
 236   3              case KEY_DOUBLE_MUTE:           
 237   3                CHANNEL_DOUBLEMUTE_FUC();
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 5   

 238   3                break;
 239   3              case KEY_LONG_POWER:
 240   3                playButtonTone();
 241   3                CHANNEL_LONGPOWER_FUC();
 242   3                break;
 243   3              case KEY_DW:
 244   3                
 245   3                if((mCbParam.Sq==0)||(mCbParam.Sq==0x20)) 
 246   3                {
 247   4                  mSqParam.DWSet=0;
 248   4                  return;
 249   4                }
 250   3                playButtonTone();
 251   3                mMenu.MenuIndex=CHANNEL_DW;
 252   3                CHANNEL_DW_FUC();
 253   3                while((Get_AD(Key2))==0x0b);
 254   3                break;
 255   3            }     
 256   2            break;
 257   2        
 258   2          case CHANNEL_DW:                                     //双频守候
 259   2            switch(key)
 260   2            {       
 261   3              
 262   3              case KEY_RFG:         
 263   3                if(mSqParam.DWSet==2)
 264   3                {
 265   4                  playButtonTone();
 266   4                  mMenu.MenuIndex=CHANNEL_RFG;
 267   4                  mMenu.BackMenuIndex=CHANNEL_DW;
 268   4                  CHANNEL_RFG_FUC();
 269   4                }
 270   3                break;
 271   3              case KEY_DN:          
 272   3                if(mSqParam.DWSet==1)
 273   3                {
 274   4                  playButtonTone();
 275   4                  CHANNEL_DN_FUC();
 276   4                }
 277   3                break;        
 278   3              case KEY_LONGDN:   
 279   3                
 280   3                if(mSqParam.DWSet==1)
 281   3                {         
 282   4                  playButtonTone();
 283   4                  while(Get_AD(Key1)==0x0A)
 284   4                  {
 285   5                    CHANNEL_LONGDN_FUC();
 286   5                  }
 287   4                }
 288   3                break;
 289   3              case KEY_UP:
 290   3            
 291   3                if(mSqParam.DWSet==1)
 292   3                {     
 293   4                  playButtonTone();
 294   4                  CHANNEL_UP_FUC();
 295   4                }
 296   3                break;
 297   3              case KEY_LONGUP:    
 298   3                if(mSqParam.DWSet==1)
 299   3                {     
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 6   

 300   4                  playButtonTone();
 301   4                  while(Get_AD(Key1)==0x0D)
 302   4                  {
 303   5                    CHANNEL_LONGUP_FUC();
 304   5                  } 
 305   4                }         
 306   3                break;
 307   3              //case KEY_AF:
 308   3              //  playButtonTone();
 309   3              //  CHANNEL_AF_FUC();
 310   3                break;
 311   3              case KEY_VOL_UP:
 312   3                if(mSqParam.DWSet==2)
 313   3                {
 314   4                  playButtonTone();
 315   4                  mMenu.MenuIndex=CHANNEL_VOL;
 316   4                  mMenu.BackMenuIndex=CHANNEL_DW;
 317   4                  CHANNEL_VOLUP_FUC();
 318   4                }
 319   3                break;        
 320   3              case KEY_VOL_DN:
 321   3                if(mSqParam.DWSet==2)
 322   3                {
 323   4                  playButtonTone();
 324   4                  mMenu.MenuIndex=CHANNEL_VOL;
 325   4                  mMenu.BackMenuIndex=CHANNEL_DW;
 326   4                  CHANNEL_VOLDN_FUC();
 327   4                }
 328   3                break;            
 329   3              case KEY_PPTDN:     
 330   3                mSqParam.DWHould=2;
 331   3                scandwPPTPress=1;
 332   3                CHANNEL_PPTDN_FUC();
 333   3                break;
 334   3              case KEY_PPTUP:
 335   3                CHANNEL_PPTUP_FUC();
 336   3                scandwPPTPress=0;
 337   3                break;
 338   3              case KEY_DOUBLE_MUTE:   
 339   3                if(mSqParam.DWSet==2)
 340   3                {           
 341   4                  playButtonTone();
 342   4                  CHANNEL_DOUBLEMUTE_FUC();
 343   4                }
 344   3                break;
 345   3              case KEY_LONG_POWER:
 346   3                CHANNEL_LONGPOWER_FUC();
 347   3                break;
 348   3              case KEY_DW:      
 349   3                playButtonTone();
 350   3                CHANNEL_DW_FUC();
 351   3                while((Get_AD(Key2))==0x0b);
 352   3                break;
 353   3            }
 354   2            break;
 355   2          case CHANNEL_RFG:                                  //RFG设置
 356   2            switch(key)
 357   2            {
 358   3              case KEY_UP:
 359   3                playButtonTone();
 360   3                mMenu.Back_Channel_Time=BACK_TIME;
 361   3                CHANNEL_RFG_UP_FUC();
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 7   

 362   3                break;
 363   3              case KEY_LONGUP:
 364   3                playButtonTone();
 365   3                while(Get_AD(Key2)==0x03)               //
 366   3                {
 367   4                  
 368   4                  mMenu.Back_Channel_Time=BACK_TIME;
 369   4                  CHANNEL_RFG_UP_FUC();
 370   4                }
 371   3                break;
 372   3              case KEY_DN:    
 373   3                playButtonTone();
 374   3                mMenu.Back_Channel_Time=BACK_TIME;
 375   3                CHANNEL_RFG_DN_FUC();
 376   3                break;
 377   3              case KEY_LONGDN:
 378   3                playButtonTone();
 379   3                CHANNEL_RFG_DN_FUC();
 380   3                while(Get_AD(Key2)==0x06)
 381   3                {
 382   4                  mMenu.Back_Channel_Time=BACK_TIME;
 383   4                  CHANNEL_RFG_DN_FUC();
 384   4                }
 385   3                break;
 386   3              case KEY_RFG:
 387   3                playButtonTone();
 388   3                mMenu.MenuIndex=CHANNEL;
 389   3                CHANNEL_MENU_BACK_FUC();
 390   3                break;
 391   3              case KEY_PPTDN:
 392   3                playButtonTone();
 393   3                mMenu.MenuIndex=CHANNEL;
 394   3                CHANNEL_MENU_BACK_FUC();
 395   3                break;
 396   3              case KEY_SCAN:          
 397   3                if(key_CombleFUPAFRFGSCAN==4)
 398   3                {
 399   4                  playButtonTone();
 400   4                  key_CombleFUPAFRFGSCAN=0;
 401   4                  mMenu.MenuIndex=CHANNEL_FUPAFRFGSCAN;          //切换国家表
 402   4                  CHANNEL_TABLE_FUC();
 403   4                }         
 404   3                break;
 405   3              case KEY_LONG_POWER:
 406   3                CHANNEL_LONGPOWER_FUC();
 407   3                break;
 408   3              default:
 409   3                break;
 410   3            }   
 411   2            break;
 412   2          case CHANNEL_SQ:                                   //SQ设置
 413   2            switch(key)
 414   2            {
 415   3              case KEY_VOL_UP:
 416   3                
 417   3                mMenu.Back_Channel_Time=BACK_TIME;
 418   3                CHANNEL_SQ_VOLUP_FUC();
 419   3                playButtonTone();
 420   3                break;        
 421   3              case KEY_VOL_DN:    
 422   3                      
 423   3                mMenu.Back_Channel_Time=BACK_TIME;
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 8   

 424   3                CHANNEL_SQ_VOLDN_FUC();
 425   3                playButtonTone();   
 426   3                break;        
 427   3              case KEY_SQ:
 428   3                playButtonTone();
 429   3                switch(key_CombleSQSet)
 430   3               {
 431   4                 case 0: key_CombleSQSet=1;
 432   4                 mSysParam.KeyComboLimit=KEY_COMBOlIMIT;
 433   4                   break;
 434   4                 case 1: key_CombleSQSet=2;
 435   4                 mSysParam.KeyComboLimit=KEY_COMBOlIMIT;
 436   4                   break;
 437   4                 case 2: key_CombleSQSet=3;
 438   4                 mSysParam.KeyComboLimit=KEY_COMBOlIMIT;
 439   4                   break;
 440   4                 case 3: key_CombleSQSet=4;
 441   4                 mSysParam.KeyComboLimit=KEY_COMBOlIMIT;
 442   4                   break;
 443   4                 case 4: key_CombleSQSet=5;
 444   4                 mSysParam.KeyComboLimit=KEY_COMBOlIMIT;
 445   4                   break;
 446   4                }
 447   3                mMenu.MenuIndex=CHANNEL;
 448   3                CHANNEL_MENU_BACK_FUC();
 449   3                break;
 450   3              case KEY_PPTDN:
 451   3                playButtonTone();
 452   3                mMenu.MenuIndex=CHANNEL;
 453   3                CHANNEL_MENU_BACK_FUC();
 454   3                break;
 455   3              case KEY_LONG_POWER:
 456   3                CHANNEL_LONGPOWER_FUC();
 457   3                break;
 458   3              case KEY_F:
 459   3                if(key_CombleSQSet==5)
 460   3                {
 461   4                  key_CombleSQSet=0;
 462   4                  mMenu.MenuIndex=CHANNEL_SQ_SET;
 463   4                  CHANNEL_SQ_SET_FUC();
 464   4                }
 465   3                break;
 466   3              default:
 467   3                break;
 468   3            }
 469   2            break;
 470   2          case CHANNEL_SQ_SET:                                //SQ调节
 471   2            switch(key)
 472   2            {
 473   3              case KEY_UP:
 474   3                playButtonTone(); 
 475   3                CHANNEL_SQ_SET_UP_FUC();
 476   3                break;
 477   3              case KEY_DN:
 478   3                playButtonTone(); 
 479   3                CHANNEL_SQ_SET_DN_FUC();
 480   3                break;
 481   3              case KEY_PPTDN:
 482   3                playButtonTone();         
 483   3                CHANNEL_MENU_BACK_FUC();
 484   3                break;
 485   3              case KEY_EMG:
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 9   

 486   3                playButtonTone();       
 487   3                mMenu.MenuIndex=CHANNEL_FRECAL;
 488   3                CHANNEL_FRECAL_FUC();
 489   3                break;
 490   3              case KEY_F:
 491   3                playButtonTone(); 
 492   3                CHANNEL_SQ_SET_F_FUC();
 493   3                break;
 494   3              default:
 495   3                break;        
 496   3            }
 497   2            
 498   2            break;
 499   2          case CHANNEL_FRECAL:
 500   2            switch(key)
 501   2            {
 502   3              case KEY_UP:
 503   3                playButtonTone(); 
 504   3                
 505   3                break;
 506   3              case KEY_DN:
 507   3                playButtonTone(); 
 508   3                
 509   3                break;
 510   3              case KEY_PPTDN:
 511   3                playButtonTone();         
 512   3                CHANNEL_MENU_BACK_FUC();
 513   3                break;
 514   3              case KEY_EMG:
 515   3                playButtonTone();       
 516   3                mMenu.MenuIndex=CHANNEL_SQ_SET;
 517   3                CHANNEL_SQ_SET_FUC();
 518   3                break;        
 519   3              default:
 520   3                break;        
 521   3            }
 522   2            break;
 523   2          case CHANNEL_SCAN:                                 //扫描模式
 524   2            switch(key)
 525   2            {
 526   3              case KEY_DN:      
 527   3                playButtonTone();
 528   3                CHANNEL_SCAN_DN_FUC();
 529   3                break;
 530   3              case KEY_UP:      
 531   3                playButtonTone();
 532   3                CHANNEL_SCAN_UP_FUC();
 533   3                break;
 534   3              case KEY_SCAN:
 535   3                playButtonTone();
 536   3                mMenu.MenuIndex=CHANNEL;
 537   3                CHANNEL_SCAN_SCAN_FUC();
 538   3                while(Get_AD(Key1)==0x0f);
 539   3                break;
 540   3              case KEY_LONG_POWER:
 541   3                CHANNEL_LONGPOWER_FUC();
 542   3                break;
 543   3              case KEY_PPTDN:     
 544   3                mSqParam.ScanHould=2;
 545   3                scandwPPTPress=1;
 546   3                CHANNEL_PPTDN_FUC();
 547   3                break;
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 10  

 548   3              case KEY_PPTUP:
 549   3                CHANNEL_PPTUP_FUC();
 550   3                scandwPPTPress=0;
 551   3                break;
 552   3              case KEY_VOL_UP:
 553   3                
 554   3                  playButtonTone();
 555   3                  mMenu.MenuIndex=CHANNEL_VOL;
 556   3                  mMenu.BackMenuIndex=CHANNEL_SCAN;
 557   3                  CHANNEL_VOLUP_FUC();
 558   3                
 559   3                break;    
 560   3              case KEY_AF:      
 561   3                playButtonTone();
 562   3                CHANNEL_AF_FUC();
 563   3                      
 564   3                break;
 565   3              case KEY_VOL_DN:
 566   3                
 567   3                  playButtonTone();
 568   3                  mMenu.MenuIndex=CHANNEL_VOL;
 569   3                  mMenu.BackMenuIndex=CHANNEL_SCAN;
 570   3                  CHANNEL_VOLDN_FUC();
 571   3                
 572   3                break;
 573   3              case KEY_RFG:
 574   3                  playButtonTone();
 575   3                  mMenu.MenuIndex=CHANNEL_RFG;
 576   3                  mMenu.BackMenuIndex=CHANNEL_SCAN;
 577   3                  CHANNEL_RFG_FUC();          
 578   3                break;
 579   3              
 580   3              case KEY_DOUBLE_MUTE:             
 581   3                  playButtonTone();
 582   3                  CHANNEL_DOUBLEMUTE_FUC();         
 583   3                break;        
 584   3              default:
 585   3                break;
 586   3            }
 587   2            break;
 588   2          case CHANNEL_VOL:                                  //音量调节模式
 589   2            switch(key)
 590   2            {
 591   3              case KEY_VOL_UP:
 592   3                if(mCbParam.VolLevel<9)
 593   3                {
 594   4                  playButtonTone();
 595   4                }
 596   3                mMenu.Back_Channel_Time=BACK_TIME;
 597   3                CHANNEL_VOLUP_FUC();
 598   3                break;
 599   3              
 600   3              case KEY_VOL_DN:
 601   3                playButtonTone();
 602   3                mMenu.Back_Channel_Time=BACK_TIME;
 603   3                CHANNEL_VOLDN_FUC();                  
 604   3                break;
 605   3              case KEY_PPTDN: 
 606   3                playButtonTone();
 607   3                
 608   3                CHANNEL_MENU_BACK_FUC();
 609   3                break;
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 11  

 610   3              case KEY_LONG_POWER:
 611   3                CHANNEL_LONGPOWER_FUC();
 612   3                break;
 613   3              default:
 614   3                break;
 615   3            }
 616   2            break;
 617   2          case CHANNEL_LONGF_PB:                             //按键音设置
 618   2            switch(key)
 619   2            {
 620   3              case KEY_UP:
 621   3                playButtonTone();
 622   3                mMenu.Back_Channel_Time=BACK_TIME;
 623   3                CHANNEL_LONGF_PB_UP_FUC();
 624   3                break;
 625   3              case KEY_LONGUP:      
 626   3                playButtonTone();
 627   3                CHANNEL_LONGF_PB_UP_FUC();
 628   3                while(Get_AD(Key1)==0x0D)
 629   3                {
 630   4                  mMenu.Back_Channel_Time=BACK_TIME;
 631   4                  CHANNEL_LONGF_PB_UP_FUC();
 632   4                }         
 633   3                break;
 634   3              case KEY_DN:
 635   3                playButtonTone();
 636   3                mMenu.Back_Channel_Time=BACK_TIME;
 637   3                CHANNEL_LONGF_PB_DN_FUC();
 638   3                break;
 639   3              case KEY_LONGDN:  
 640   3                playButtonTone();
 641   3                while(Get_AD(Key1)==0x0A)
 642   3                {
 643   4                  CHANNEL_LONGF_PB_DN_FUC();
 644   4                  mMenu.Back_Channel_Time=BACK_TIME;
 645   4                  CHANNEL_LONGF_PB_DN_FUC();
 646   4                }
 647   3                break;
 648   3              case KEY_F:
 649   3                playButtonTone();
 650   3                mMenu.Back_Channel_Time=BACK_TIME;
 651   3                mMenu.MenuIndex=CHANNEL_LONGF_F_FB;
 652   3                CHANNEL_LONGF_F_FB_FUC();
 653   3                break;
 654   3              case KEY_PPTDN:
 655   3                playButtonTone();
 656   3                mMenu.MenuIndex=CHANNEL;          
 657   3                CHANNEL_MENU_BACK_FUC();
 658   3                break;
 659   3              case KEY_LONG_POWER:
 660   3                CHANNEL_LONGPOWER_FUC();
 661   3                break;
 662   3              default:
 663   3                break;
 664   3            }
 665   2            break;
 666   2          case CHANNEL_LONGF_F_F_FC:                           //LCD颜色设置
 667   2            switch(key)
 668   2            {
 669   3              case KEY_UP:
 670   3                playButtonTone();
 671   3                mMenu.Back_Channel_Time=BACK_TIME;
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 12  

 672   3                CHANNEL_LONGF_F_F_FC_UP_FUC();
 673   3                break;
 674   3              case KEY_LONGUP:
 675   3                playButtonTone();
 676   3                CHANNEL_LONGF_F_F_FC_UP_FUC();          
 677   3                while(Get_AD(Key1)==0x0D)
 678   3                {
 679   4                  mMenu.Back_Channel_Time=BACK_TIME;
 680   4                  CHANNEL_LONGF_F_F_FC_UP_FUC();
 681   4                }         
 682   3                break;
 683   3              case KEY_DN:
 684   3                playButtonTone();
 685   3                mMenu.Back_Channel_Time=BACK_TIME;
 686   3                CHANNEL_LONGF_F_F_FC_DN_FUC();
 687   3                break;
 688   3              case KEY_LONGDN:
 689   3                playButtonTone();
 690   3                CHANNEL_LONGF_F_F_FC_DN_FUC();
 691   3                while(Get_AD(Key1)==0x0A)
 692   3                {
 693   4                  mMenu.Back_Channel_Time=BACK_TIME;
 694   4                  CHANNEL_LONGF_F_F_FC_DN_FUC();
 695   4                }
 696   3                break;
 697   3              case KEY_F:
 698   3                playButtonTone();
 699   3                mMenu.Back_Channel_Time=BACK_TIME;
 700   3                mMenu.MenuIndex=CHANNEL_LONGF_PB;
 701   3                CHANNEL_LONGF_PB_FUC();
 702   3                break;
 703   3              case KEY_PPTDN:
 704   3                playButtonTone();
 705   3                mMenu.MenuIndex=CHANNEL;          
 706   3                CHANNEL_MENU_BACK_FUC();
 707   3                break;
 708   3              case KEY_LONG_POWER:
 709   3                CHANNEL_LONGPOWER_FUC();
 710   3                break;
 711   3              default:
 712   3                break;
 713   3            }
 714   2            break;
 715   2          case CHANNEL_LONGF_F_FB:                         //按键灯设置
 716   2            switch(key)
 717   2            {
 718   3              case KEY_UP:
 719   3                playButtonTone();
 720   3                mMenu.Back_Channel_Time=BACK_TIME;
 721   3                CHANNEL_LONGF_F_FB_UP_FUC();
 722   3                break;
 723   3              case KEY_LONGUP:  
 724   3                playButtonTone();
 725   3                CHANNEL_LONGF_F_FB_UP_FUC();
 726   3                while(Get_AD(Key1)==0x0D)
 727   3                {
 728   4                  mMenu.Back_Channel_Time=BACK_TIME;
 729   4                  CHANNEL_LONGF_F_FB_UP_FUC();
 730   4                }         
 731   3                break;
 732   3              case KEY_DN:
 733   3                playButtonTone();
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 13  

 734   3                mMenu.Back_Channel_Time=BACK_TIME;
 735   3                CHANNEL_LONGF_F_FB_DN_FUC();
 736   3                break;
 737   3              case KEY_LONGDN:  
 738   3                playButtonTone();         
 739   3                CHANNEL_LONGF_F_FB_DN_FUC();
 740   3                while(Get_AD(Key1)==0x0A)
 741   3                {
 742   4                  mMenu.Back_Channel_Time=BACK_TIME;
 743   4                  CHANNEL_LONGF_F_FB_DN_FUC();
 744   4                }
 745   3                break;
 746   3              case KEY_F:
 747   3                playButtonTone();
 748   3                mMenu.Back_Channel_Time=BACK_TIME;
 749   3                mMenu.MenuIndex=CHANNEL_LONGF_F_F_FC;
 750   3                CHANNEL_LONGF_F_F_FC_FUC();
 751   3                break;
 752   3              case KEY_PPTDN:
 753   3                playButtonTone();
 754   3                mMenu.MenuIndex=CHANNEL;          
 755   3                CHANNEL_MENU_BACK_FUC();
 756   3              
 757   3                break;
 758   3              case KEY_LONG_POWER:
 759   3                CHANNEL_LONGPOWER_FUC();
 760   3                break;
 761   3              default:
 762   3                break;
 763   3            }
 764   2            break;
 765   2          case CHANNEL_DOUBLEF:                              //锁屏模式
 766   2            switch(key)
 767   2            {
 768   3              case KEY_PPTDN:
 769   3                
 770   3                CHANNEL_PPTDN_FUC();
 771   3                break;
 772   3              case KEY_PPTUP:
 773   3                
 774   3                CHANNEL_PPTUP_FUC();
 775   3                break;
 776   3              case KEY_F: 
 777   3              
 778   3                playButtonTone();
 779   3                if(key_UnLockcount==0) 
 780   3                {
 781   4                  mSysParam.KeyComboLimit=KEY_COMBOlIMIT;
 782   4                  mSysParam.isKeyCombo=1;
 783   4                  
 784   4                  key_UnLockcount=1;        
 785   4                }
 786   3                else if(key_UnLockcount==1) 
 787   3                {                       
 788   4                  CHANNEL_DOUBLEF_FUC();
 789   4                    mMenu.MenuIndex=CHANNEL;
 790   4                  key_UnLockcount=0;          
 791   4                }
 792   3                else key_UnLockcount=0;         
 793   3                break;      
 794   3              case KEY_LONG_POWER:
 795   3                CHANNEL_LONGPOWER_FUC();
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 14  

 796   3                break;        
 797   3              case KEY_VOL_UP:
 798   3                playButtonTone();
 799   3                mMenu.MenuIndex=CHANNEL_VOL;
 800   3                mMenu.BackMenuIndex=CHANNEL_DOUBLEF;
 801   3                CHANNEL_VOLUP_FUC();
 802   3                break;
 803   3              case KEY_VOL_DN:
 804   3                playButtonTone();
 805   3                mMenu.MenuIndex=CHANNEL_VOL;
 806   3                mMenu.BackMenuIndex=CHANNEL_DOUBLEF;
 807   3                CHANNEL_VOLDN_FUC();
 808   3                break;
 809   3              default:
 810   3                CHANNEL_LOCK_PRESSOTHER_FUC();
 811   3                break;
 812   3            }
 813   2            break;    
 814   2          case CHANNEL_PPTDN:                                //发射模式
 815   2            switch(key)
 816   2            {
 817   3              case KEY_PPTUP:
 818   3                mMenu.MenuIndex=CHANNEL;
 819   3                CHANNEL_PPTUP_FUC();
 820   3                break;
 821   3              case KEY_LONG_POWER:
 822   3                mMenu.MenuIndex=CHANNEL;
 823   3                CHANNEL_LONGPOWER_FUC();
 824   3                break;
 825   3              default:
 826   3                break;
 827   3            }
 828   2            break;
 829   2      
 830   2          case CHANNEL_FAF:                                //国家设置
 831   2            switch(key)
 832   2            {     
 833   3              case KEY_DN:
 834   3                playButtonTone();
 835   3                CHANNEL_FAF_DN_FUC();
 836   3                break;
 837   3              case KEY_LONGDN:  
 838   3                playButtonTone();
 839   3                CHANNEL_FAF_DN_FUC();
 840   3                while(Get_AD(Key1)==0x0A)
 841   3                {
 842   4                  CHANNEL_FAF_DN_FUC();
 843   4                }
 844   3                break;
 845   3              case KEY_UP:
 846   3                playButtonTone();
 847   3                CHANNEL_FAF_UP_FUC();
 848   3                break;    
 849   3              case KEY_LONGUP:  
 850   3                playButtonTone();
 851   3                CHANNEL_FAF_UP_FUC();
 852   3                while(Get_AD(Key1)==0x0D)
 853   3                {
 854   4                  CHANNEL_FAF_UP_FUC();
 855   4                }         
 856   3                break;
 857   3              case KEY_PPTDN:
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 15  

 858   3                playButtonTone();
 859   3                mMenu.MenuIndex=CHANNEL;
 860   3                CHANNEL_FAF_PPT_FUC();
 861   3                while(PPT_KEY==0);
 862   3                break;            
 863   3              case KEY_LONG_POWER:
 864   3                CHANNEL_LONGPOWER_FUC();
 865   3                break;    
 866   3            }     
 867   2            break;
 868   2          case CHANNEL_FUPAFRFGSCAN:                                  //切换国家表模式
 869   2            switch(key)
 870   2            { 
 871   3              case KEY_DN:
 872   3                playButtonTone();
 873   3                CHANNEL_FUPAFRFGSCAN_DN_FUC();
 874   3                break;
 875   3              case KEY_LONGDN:  
 876   3                playButtonTone();
 877   3                CHANNEL_FUPAFRFGSCAN_DN_FUC();
 878   3                while(Get_AD(Key1)==0x0A)
 879   3                {
 880   4                  CHANNEL_FUPAFRFGSCAN_DN_FUC();
 881   4                }
 882   3                break;
 883   3              case KEY_UP:
 884   3                playButtonTone();
 885   3                CHANNEL_FUPAFRFGSCAN_UP_FUC();
 886   3                break;    
 887   3              case KEY_LONGUP:  
 888   3                playButtonTone();
 889   3                CHANNEL_FUPAFRFGSCAN_UP_FUC();
 890   3                while(Get_AD(Key1)==0x0D)
 891   3                {
 892   4                  CHANNEL_FUPAFRFGSCAN_UP_FUC();
 893   4                }         
 894   3                break;
 895   3              case KEY_F:
 896   3                playButtonTone();
 897   3                mMenu.MenuIndex=CHANNEL_FAF;
 898   3                for(i=0;i<3;i++)
 899   3                {
 900   4                  LCD_CLEAR();
 901   4                  TM1722_SHOW();
 902   4                  delayms(70);
 903   4                  ShowTable();  
 904   4                  delayms(70);
 905   4                }
 906   3                CHANNEL_FAF_FUC();
 907   3                break;            
 908   3              case KEY_LONG_POWER:
 909   3                CHANNEL_LONGPOWER_FUC();
 910   3                break;  
 911   3            }       
 912   2            break;
 913   2          default:
 914   2            break;
 915   2        }
 916   1        mMenu.isBussy=0;
 917   1      }
 918            
 919          /*-------------------------------------------------------------------------
C51 COMPILER V9.52.0.0   MENU                                                              06/02/2018 10:26:52 PAGE 16  

 920          *函数：InitMenu  菜单参数初使化
 921          *参数：无  
 922          *返回值：无
 923          *-------------------------------------------------------------------------*/
 924          void InitMenu(void)
 925          {
 926   1        mMenu.isBussy=0;
 927   1        mMenu.MenuIndex=0;
 928   1        mMenu.Back_Channel_Time=BACK_TIME;
 929   1        mMenu.isLock=0;
 930   1        mMenu.emgIndex=0;
 931   1        mMenu.isTx=0;
 932   1        mFlag.InMainFace = 0;
 933   1        mHmSetting.SpkerSwitch=1;
 934   1        mSqParam.DWHould=1;
 935   1        mSqParam.ScanHould=1;
 936   1        mSqParam.Scan=1;
 937   1        mSqParam.DWHould=1;
 938   1        mSqParam.DWSet=0;
 939   1        mSqParam.HouldTime=0;
 940   1        mSqParam.DisHould=0;
 941   1        mSqParam.OpenOrClose=0;
 942   1      }
 943          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3446    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     14       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
